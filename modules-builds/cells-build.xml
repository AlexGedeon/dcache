<!-- $Id: cells-build.xml,v 1.12 2007-05-24 13:52:15 tigran Exp $ -->

<project name="Cells" default="help" basedir=".">


    <!--
          Properties  -  the following properties, paths, and selectors
                         define the locations and files for Cells
  -->

    <!-- Output Files
       For each of these jar files there are targets below -->

    <property name="cells.jar" location="${classesDir}/cells.jar" />
    <property name="cells-protocols.jar" location="${classesDir}/cells-protocols.jar" />
    <property name="cells.build.dir" location="${buildDir}/cells" />

    <target name="-isUptodate.cells.jar">
        <condition property="cells.jar.upToDate">
            <and>
                <available file="${cells.jar}" type="file" />
                <uptodate targetfile="${cells.jar}">
                    <srcfiles dir="${cells.src}">
                        <include name="**/*.java" />
                    </srcfiles>
                </uptodate>
            </and>
        </condition>
    </target>

    <target name="-isUptodate.cells-protocols.jar">
        <condition property="cells-protocols.jar.upToDate">
            <and>
                <available file="${cells-protocols.jar}" type="file" />
                <uptodate targetfile="${cells-protocols.jar}">
                    <srcfiles dir="${cells.src}">
                        <include name="**/*.java" />
                    </srcfiles>
                </uptodate>
            </and>
        </condition>
    </target>



    <!-- Packages for cells.jar -->

    <selector id="cells.selector">
        <or>
            <filename name="dmg/util/*" />
            <filename name="dmg/util/cdb/*" />
            <filename name="dmg/util/edb/*" />
            <filename name="dmg/cells/network/*" />
            <filename name="dmg/cells/nucleus/*" />
            <filename name="dmg/cells/nucleus/protocols/env/*" />
            <filename name="dmg/cells/nucleus/protocols/context/*" />
            <filename name="dmg/cells/nucleus/protocols/cell/*" />
            <filename name="dmg/cells/services/*" />
            <filename name="dmg/cells/services/login/*" />
            <filename name="dmg/cells/services/login/user/*" />
            <filename name="dmg/cells/services/gui/*" />
            <filename name="dmg/cells/services/multicaster/*" />
            <filename name="dmg/cells/applets/*" />
            <filename name="dmg/cells/applets/spy/*" />
            <filename name="dmg/cells/applets/login/*" />
            <filename name="dmg/cells/applets/alias/*" />
            <filename name="dmg/security/*" />
            <filename name="dmg/security/cipher/*" />
            <filename name="dmg/security/cipher/rsa/*" />
            <filename name="dmg/security/cipher/idea/*" />
            <filename name="dmg/security/cipher/pgp/*" />
            <filename name="dmg/security/cipher/des/*" />
            <filename name="dmg/security/cipher/blowfish/*" />
            <filename name="dmg/security/digest/*" />
            <filename name="dmg/protocols/telnet/*" />
            <filename name="dmg/protocols/snmp/*" />
            <filename name="dmg/protocols/ssh/*" />
            <filename name="dmg/protocols/kerberos/*" />
            <filename name="dmg/protocols/ber/*" />
            <filename name="org/pcells/**/*" />
        </or>
    </selector>

    <!-- Maybe this one should be used for cells.jar   (from Tigrans build.xml)    -->

    <selector id="cells.selector.new">
        <filename negate="true" name="dmg/apps/**" />
    </selector>

    <!-- Packages for cells-protocols.jar -->

    <selector id="cells-protocols.selector">
        <or>
            <filename name="dmg/cells/nucleus/protocols/env/*" />
            <filename name="dmg/cells/nucleus/protocols/context/*" />
            <filename name="dmg/cells/nucleus/protocols/cell/*" />
        </or>
    </selector>


    <!-- Classpath for cells.jar -->

    <path id="cells.classpath">
        <pathelement location="${libDir}/log4j/log4j-1.2.15.jar" />
        <fileset dir="${libDir}/slf4j" includes="*.jar" />
        <fileset dir="${libDir}/jline" includes="jline*.jar" />
    </path>

    <!--
             Targets for cells.jar
    -->

    <!--
        Compile cells
    -->

    <target name="-cells.compile" unless="-cells.jar.upToDate">

        <mkdir dir="${cells.build.dir}" />

        <javac destdir="${cells.build.dir}" source="${javac.source}" target="${javac.target}" classpathref="cells.classpath" debug="${javac.debug}" verbose="${javac.verbose}">
            <src path="${cells.src}" />
            <and>
                <selector refid="cells.selector" />
                <filename name="**/*.java" />
            </and>
        </javac>

    </target>

    <!--
        build cells.jar
    -->
    <target name="-cells.jar" depends="-isUptodate.cells.jar,-cells.compile" unless="cells.jar.upToDate">

        <jar jarfile="${cells.jar}">
            <fileset dir="${cells.build.dir}">
                <and>
                    <selector refid="cells.selector" />
                    <filename name="**/*.class" />
                </and>
            </fileset>
        </jar>

    </target>

    <!--
          build protocls.jar
    -->
    <target name="-cells-protocols.jar" depends="-cells.compile">

        <jar jarfile="${cells-protocols.jar}">
            <fileset dir="${cells.build.dir}">
                <and>
                    <selector refid="cells-protocols.selector" />
                    <filename name="**/*.class" />
                </and>
            </fileset>
        </jar>

    </target>


    <target name="-cells.bin" depends="-cells.jar,-cells-protocols.jar">

        <!-- directory layout :

        <dCache home>-|
                      |-classes
    -->

        <mkdir dir="${server.bin.dir}/classes" />
        <copy file="${classesDir}/cells.jar" todir="${server.bin.dir}/classes" />
        <copy todir="${server.bin.dir}/classes/jline">
            <fileset dir="${libDir}/jline/">
                <include name="*.jar" />
            </fileset>
        </copy>
    </target>

    <target name="-cells-protocols-bin" depends="-cells.jar,-cells-protocols.jar">

        <!-- directory layout :

        <dCache home>-|
                      |-classes
    -->

        <mkdir dir="${server.bin.dir}/classes" />
        <copy file="${classesDir}/cells.jar" todir="${server.bin.dir}/classes" />
        <copy file="${classesDir}/cells-protocols.jar" todir="${server.bin.dir}/classes" />
    </target>


</project>
