<!-- $Id: cells-build.xml,v 1.0 2008-09-19 13:52:15 tdh Exp $ -->

<project name="gPlazma" default="help" basedir=".">

    <property name="gplazma.build.dir" location="${buildDir}/gplazma" />
    <!--
          Properties  -  the following properties, paths, and selectors
                         define the locations and files for gPlazma
    -->

    <!-- Output Files
       For each of these jar files there are targets below -->

    <property name="gplazma.jar" location="${classesDir}/gplazma.jar" />

    <!--
        check is jar file up to date
    -->
    <target name="-isUptodate.gplazma.jar">
        <condition property="gplazma.jar.upToDate">
            <and>
                <available file="${gplazma.jar}" type="file" />
                <uptodate targetfile="${gplazma.jar}">
                    <srcfiles dir="${gplazma.junit.src}">
                        <include name="**/*.java" />
                        <include name="**/*.fixture" />
                    </srcfiles>
                    <srcfiles dir="${gplazma.src}">
                        <include name="**/*.java" />
                    </srcfiles>
                </uptodate>
            </and>
        </condition>
    </target>

    <!-- Classpath for gplazma.jar. -->

    <path id="gplazma.classpath">
        <fileset dir="${libDir}/cog" includes="**/*.jar" excludes="**/commons-logging-*.jar, **/cog-*dcache*.jar"/>
        <pathelement location="${libDir}/security/bcprov-jdk15-143.jar" />
        <fileset dir="${libDir}/opensaml" includes="**/*.jar" />
        <fileset dir="${libDir}/gplazma" includes="**/*.jar" />
        <pathelement location="${classesDir}/dcache-common.jar" />
        <pathelement location="${libDir}/junit/junit-4.3.1.jar" />
        <path refid="dependency.classpath" />
    </path>


    <!--
        compile sources
    -->

    <target name="-gplazma.compile" unless="-gplazma.jar.upToDate">

        <mkdir dir="${gplazma.build.dir}" />

        <javac destdir="${gplazma.build.dir}" source="${javac.source}" target="${javac.target}" classpathref="gplazma.classpath" debug="${javac.debug}" verbose="${javac.verbose}" includeAntRuntime="false">
            <compilerarg value="-Xlint"/>
            <src path="${gplazma.src}" />
            <src path="${gplazma.junit.src}" />
            <filename name="**/*.java" />
        </javac>
        <!--and the plugins xml-->
        <copy file="${gplazma.src}/../skel/META-INF/gplazma-plugins.xml" todir="${gplazma.build.dir}/META-INF"/>
    </target>

    <!--
        build gplazma jar
    -->
    <target name="-gplazma.jar" depends="-isUptodate.gplazma.jar,-gplazma.compile" unless="gplazma.jar.upToDate">

        <jar jarfile="${gplazma.jar}">
            <fileset dir="${gplazma.build.dir}">
                    <filename name="**/*.class" />
            </fileset>
            <fileset dir="${gplazma.build.dir}">
                    <filename name="**/*.xml" />
            </fileset>
            <fileset dir="${gplazma.junit.src}">
                <filename name="**/*.fixture" />
            </fileset>
        </jar>
    </target>

    <!-- For deployment -->
    <target name="-gplazma.bin" depends="-gplazma.jar">
        <mkdir dir="${server.bin.dir}/classes/gplazma" />
        <copy file="${classesDir}/gplazma.jar" todir="${server.bin.dir}/classes/gplazma" />
    </target>

</project>
