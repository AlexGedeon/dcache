<!-- $Id: cells-build.xml,v 1.0 2008-09-19 13:52:15 tdh Exp $ -->

<project name="gPlazma" default="help" basedir=".">

    <property name="gplazma.build.dir" location="${buildDir}/gplazma" />
    <!--
          Properties  -  the following properties, paths, and selectors
                         define the locations and files for gPlazma
    -->

    <!-- Output Files
       For each of these jar files there are targets below -->

    <property name="gplazma.jar" location="${classesDir}/gplazma.jar" />

    <!--
        check is jar file up to date
    -->
    <target name="-isUptodate.gplazma.jar">
        <condition property="gplazma.jar.upToDate">
            <and>
                <available file="${gplazma.jar}" type="file" />
                <uptodate targetfile="${gplazma.jar}">
                    <srcfiles dir="${gplazma.src}">
                        <include name="**/*.java" />
                    </srcfiles>
                </uptodate>
            </and>
        </condition>
    </target>

    <!-- Packages for gplazma.jar -->

    <selector id="gplazma.selector">
        <or>
            <filename name="gplazma/**" />
        </or>
    </selector>

    <!-- Classpath for gplazma.jar. -->

    <path id="gplazma.classpath">
        <fileset dir="${axis.untared}" includes="**/*.jar" excludes="**/log4j-*.jar"/>
        <fileset dir="${libDir}/cog" includes="**/*.jar" />
        <pathelement location="${libDir}/security/bcprov-jdk15-143.jar" />
        <fileset dir="${glite.untarred}" includes="**/*.jar" />
        <fileset dir="${libDir}/opensaml" includes="**/*.jar" />
        <fileset dir="${libDir}/gplazma" includes="**/*.jar" />
        <fileset dir="${libDir}/log4j" includes="*.jar" />
        <fileset dir="${libDir}/slf4j" includes="*.jar" />
    </path>


    <!--
        compile sources
    -->

    <target name="-gplazma.compile" unless="-gplazma.jar.upToDate">

        <mkdir dir="${gplazma.build.dir}" />

        <javac destdir="${gplazma.build.dir}" source="${javac.source}" target="${javac.target}" classpathref="gplazma.classpath" debug="${javac.debug}" verbose="${javac.verbose}">
            <src path="${gplazma.src}" />
            <and>
                <filename name="**/*.java" />
            </and>
        </javac>

    </target>

    <!--
        build gplazma jar
    -->
    <target name="-gplazma.jar" depends="-isUptodate.gplazma.jar,-gplazma.compile" unless="gplazma.jar.upToDate">

        <jar jarfile="${gplazma.jar}">
            <fileset dir="${gplazma.build.dir}">
                <and>
                    <selector refid="gplazma.selector" />
                    <filename name="**/*.class" />
                </and>
            </fileset>
        </jar>

    </target>

    <!-- For deployment -->
    <target name="-gplazma.bin" depends="-gplazma.jar">
        <mkdir dir="${server.bin.dir}/classes/gplazma" />
        <copy file="${classesDir}/gplazma.jar" todir="${server.bin.dir}/classes/gplazma" />
    </target>

</project>
