<!-- $Id: srm-build.xml,v 1.10 2007-04-24 09:43:18 tigran Exp $ -->

<project name="SRM" default="help" basedir=".">

    <property name="srm.build.dir" location="${buildDir}/srm" />


    <!--
          Properties  -  the following properties, paths, and selectors
                         define the locations and files for Cells
    -->

    <!-- Output Files
       For each of these jar files there are targets below -->

    <property name="srm.jar" location="${classesDir}/srm.jar" />

    <target name="-isUptodate.srm.jar">
        <condition property="srm.jar.upToDate">
            <and>
                <available file="${srm.jar}" type="file" />
                <uptodate targetfile="${srm.jar}">
                    <srcfiles dir="${srm.src}">
                        <include name="**/*.java" />
                    </srcfiles>
                </uptodate>
            </and>
        </condition>
    </target>

    <!-- Packages for srm.jar -->

    <!-- Classpath for srm.jar -->

    <path id="srm.classpath">
        <fileset dir="${axis.untared}">
          <include name="**/*.jar"/>
          <exclude name="**/log4j-*.jar"/>
          <exclude name="**/commons-logging-*.jar"/>
        </fileset>
        <fileset dir="${libDir}/cog" includes="**/*.jar" excludes="**/commons-logging-*.jar"/>
        <fileset dir="${libDir}/security" includes="**/*.jar" />
        <fileset dir="${glite.untarred}" includes="**/*.jar" />
        <fileset dir="${libDir}/terapaths" includes="*.jar" />
        <fileset dir="${libDir}/log4j" includes="*.jar" />
        <fileset dir="${libDir}/slf4j" includes="*.jar" />
        <pathelement location="${classesDir}/dcache-common.jar" />
        <pathelement location="${libDir}/jdom/jdom.jar" />
        <pathelement location="${classesDir}/cells.jar" />
	<pathelement location="${classesDir}/gplazma.jar" />
        <fileset dir="${libDir}/servlet-api/" includes="*.jar" />
    </path>

    <!--       =======
             TARGETS
             =======          -->

    <!--
        compile srm code
    -->
    <target name="-srm.compile" unless="srm.jar.upToDate" depends="-prepare,-lib.axis.untar,-lib.glite.untar">

        <mkdir dir="${srm.build.dir}" />
        <javac destdir="${srm.build.dir}" classpathref="srm.classpath" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}">
            <src path="${srm.src}" />
            <and>
                <filename name="**/*.java" />
            </and>
        </javac>

    </target>

    <!--
        generate srm jar
    -->
    <target name="-srm.jar" depends="-isUptodate.srm.jar,-srm.compile" unless="srm.jar.upToDate">

        <jar jarfile="${srm.jar}">
            <fileset dir="${srm.build.dir}">
                <and>
                    <filename name="**/*.class" />
                </and>
            </fileset>
        </jar>

    </target>

    <!--
          Generate Doc
    -->

    <target name="docs" depends="-prepare" description="Generate Javadoc in ${distDir}/doc/javadoc">

        <javadoc destdir="${distDir}/doc/javadoc" sourcepath="${srm.src}" packagenames="org.dcache.srm.*" linksource="true" />

    </target>

    <target name="docs.clean">

        <delete dir="${distDir}/doc" />

    </target>



    <target name="-srm.bin" depends="-srm.jar">

        <!-- directory layout :

        <dCache home>-|
                      |-classes
                      |-jobs
                      |-config
                      |-etc
                      |-install
    -->

        <mkdir dir="${server.bin.dir}/classes" />
        <mkdir dir="${server.bin.dir}/jobs" />
        <mkdir dir="${server.bin.dir}/config" />
        <mkdir dir="${server.bin.dir}/libexec" />

        <!-- jar file  -->
        <copy file="${classesDir}/srm.jar" todir="${server.bin.dir}/classes" />

        <mkdir dir="${server.bin.dir}/etc" />
        <mkdir dir="${server.bin.dir}/install" />
        <copy file="${srm.src}/sbin/upgrade_space_manager_schema.sh" todir="${server.bin.dir}/install" />

    </target>



</project>
