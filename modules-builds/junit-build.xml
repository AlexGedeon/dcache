<!-- $Id: junit-build.xml,v 1.4 2007-10-25 14:05:31 tigran Exp $ -->

<project name="Cells" basedir=".">


        <!-- import the common part -->

        <import file="${buildTop}/common/common.xml"/>


	   <!-- JUnit test suite -->

	    <path id="junit.classpath">
	        <pathelement location="${classesDir}/cells.jar"/>
	        <pathelement location="${classesDir}/dcache.jar"/>
	        <pathelement location="${classesDir}/gplazma.jar"/>
	    	<pathelement location="${classesDir}/xrootd-tokenauthz.jar"/>
	        <pathelement location="${libDir}/Chimera/chimera-core.jar"/>
	        <pathelement location="${libDir}/Chimera/chimera-acl.jar"/>
	        <pathelement location="${libDir}/Chimera/hsqldb.jar"/>
	        <pathelement location="${libDir}/dbcp/c3p0-0.9.1.2.jar"/>
	        <pathelement location="${libDir}/junit/junit-4.3.1.jar"/>
	        <pathelement location="${libDir}/log4j/log4j-1.2.8.jar"/>
	        <pathelement location="${libDir}/berkeleyDB/je-3.2.76.jar" />
	    	<pathelement location="${libDir}/cog/cog-srmlib/cog-jglobus.jar" />
                <pathelement location="${libDir}/persistence/persistence-api-1.0.jar" />

	        <pathelement location="${buildDir}/junit"/>
            <pathelement location="${buildTop}/modules/dCache/diskCacheV111/config" />
	    </path>

	
	    <target name="compile_junit" description="compile junit tests">
	    	
	        <mkdir dir="${buildDir}/junit" />
	        <javac classpathref="junit.classpath" destdir="${buildDir}/junit" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}"  encoding="${javac.encoding}" deprecation="on">
	            <src path="${sourceDir}" />
	        </javac>
	    	
	    </target>
	
	    <target name="run_junit.core" depends="compile_junit">

	        <property name="tests.report.home" location="${buildDir}/junit-reports"/>
	        <mkdir dir="${tests.report.home}" />
	    	
	        <junit fork="true">
	            <classpath refid="junit.classpath" />
	            <formatter type="xml" usefile="true" />
	            <formatter type="brief" usefile="false" />
	            <batchtest todir="${tests.report.home}" haltonfailure="no" >
	                <fileset dir="${buildDir}/junit" >
	                    <include name="**/*.class" />
	                	
	                	<!-- Ignore any classes that are not, by themselves, test-cases -->
	                    <exclude name="**/*$*.class" />
	                    <exclude name="**/*Helper.class" />
                        <exclude name="org/dcache/tests/cells/Message.class"/>
	                	<exclude name="org/dcache/services/info/base/InfoBaseTest.class"/>
	                </fileset>
	            </batchtest>
                </junit>

	    </target>

</project>
