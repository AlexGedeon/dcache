<?xml version="1.0"?>
<project name="srmclient" default="help">


  <!-- package name. have to be the same as in the cvs -->
  <property name="package" value="srmclient" />

	<!-- import the common part -->

	<import file="${buildTop}/common/common.xml"/>


	<property name="srm_client.jar" value="${classesDir}/srm_client.jar"/>


	<target name="cleanall" depends="clean" description="Remove everything produced by me.">
		<delete file="${srm-client.jar}" />
	</target>


	<selector id="srmclient.selector">
		<and>
			<filename name="**/ArgParser.java" />
			<filename name="**/Configuration.java" />
			<filename name="**/Copier.java" />
			<filename name="**/CopyJob.java" />
			<filename name="**/SRMClient.java" />
			<filename name="**/SRMGetClientV1.java" />
			<filename name="**/SRMGetClientV2.java" />
			<filename name="**/SRMPutClientV1.java" />
			<filename name="**/SRMPutClientV2.java" />
			<filename name="**/SRMLsClientV2.java" />
			<filename name="**/ShellCommandExecuter.java" />
			<filename name="**/SRMDispatcher.java" />
			<filename name="**/KFTPArgsConverter.java" />
			<filename name="**/DccpArgsConverter.java" />
			<filename name="**/CopyJobFileReader.java" />
			<filename name="**/SRMGetFileMetaDataClientV1.java" />
			<filename name="**/SRMAdvisoryDeleteClientV1.java" />
			<filename name="**/SRMGetRequestStatusClientV1.java" />
			<filename name="**/Report.java" />
			<filename name="**/SRMRmClientV2.java" />
			<filename name="**/SRMMkDirClientV2.java" />
			<filename name="**/SRMRmdirClientV2.java" />
			<filename name="**/SRMMvClientV2.java" />
			<filename name="**/Version.java" />
			<filename name="**/SRMV1CopyJob.java" />
			<filename name="**/SRMV2CopyJob.java" />
			<filename name="**/SRMCopyClientV2.java" />
			<filename name="**/SRMCopyClientV1.java" />
			<filename name="**/SRMStageClientV1.java" />
			<filename name="**/SRMGetRequestSummaryClientV2.java" />
			<filename name="**/SRMGetRequestTokensClientV2.java" />
             </and>
	</selector>

	<selector id="srmclient.classpath.selector">
		<or>
			<filename name="**/cells.jar" />
			<filename name="**/srm.jar" />
			<filename name="jdom/jdom.jar" />
			<filename name="cog/**/*.jar" />
			<filename name="axis/**/*.jar" />
			<filename name="glue/**/GLUE-STD.jar" />
			<filename name="glue/**/dom.jar" />
			<filename name="glue/**/jnet.jar" />
			<filename name="glue/**/jsse.jar" />
			<filename name="glue/**/jcert.jar" />
			<filename name="glue/**/servlet.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/bin/*.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/common/lib/*.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/server/lib/*.jar" />
		</or>
	</selector>

	<path id="srmclient.classpath">
		<fileset dir="${classesDir}">
			<selector refid="srmclient.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="srmclient.classpath.selector" />
		</fileset>
	</path>

	<target name="srmclient.compile">

		<mkdir dir="${buildDir}/srm-client" />

		<javac destdir="${buildDir}/srm-client" classpathref="srmclient.classpath" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}">
			<src path="${sourceDir}" />
			<include name="gov/fnal/srm/util/ArgParser.java" />
			<include name="gov/fnal/srm/util/Configuration.java" />
			<include name="gov/fnal/srm/util/Copier.java" />
			<include name="gov/fnal/srm/util/CopyJob.java" />
			<include name="gov/fnal/srm/util/SRMClient.java" />
			<include name="gov/fnal/srm/util/SRMGetClientV1.java" />
			<include name="gov/fnal/srm/util/SRMGetClientV2.java" />
			<include name="gov/fnal/srm/util/SRMPutClientV1.java" />
			<include name="gov/fnal/srm/util/SRMPutClientV2.java" />
			<include name="gov/fnal/srm/util/SRMLsClientV2.java" />
			<include name="gov/fnal/srm/util/ShellCommandExecuter.java" />
			<include name="gov/fnal/srm/util/SRMDispatcher.java" />
			<include name="gov/fnal/srm/util/KFTPArgsConverter.java" />
			<include name="gov/fnal/srm/util/DccpArgsConverter.java" />
			<include name="gov/fnal/srm/util/CopyJobFileReader.java" />
			<include name="gov/fnal/srm/util/SRMGetFileMetaDataClientV1.java" />
			<include name="gov/fnal/srm/util/SRMAdvisoryDeleteClientV1.java" />
			<include name="gov/fnal/srm/util/SRMGetRequestStatusClientV1.java" />
			<include name="gov/fnal/srm/util/Report.java" />
			<include name="gov/fnal/srm/util/SRMRmClientV2.java" />
			<include name="gov/fnal/srm/util/SRMMkDirClientV2.java" />
			<include name="gov/fnal/srm/util/SRMRmdirClientV2.java" />
			<include name="gov/fnal/srm/util/SRMMvClientV2.java" />
			<include name="gov/fnal/srm/util/Version.java" />
			<include name="gov/fnal/srm/util/SRMV1CopyJob.java" />
			<include name="gov/fnal/srm/util/SRMV2CopyJob.java" />
			<include name="gov/fnal/srm/util/SRMCopyClientV2.java" />
			<include name="gov/fnal/srm/util/SRMCopyClientV1.java" />
			<include name="gov/fnal/srm/util/SRMStageClientV1.java" />
			<include name="gov/fnal/srm/util/SRMGetRequestSummaryClientV2.java" />
			<include name="gov/fnal/srm/util/SRMGetRequestTokensClientV2.java" />

		</javac>

	</target>


	<target name="srmclient.jar" depends="srmclient.compile">

		<jar jarfile="${srm_client.jar}">

			<fileset dir="${buildDir}/srm-client" includes="**/*.class" />
			<manifest>
				<section name="Shared">
					<attribute name="Title" value="Storage Resource Manager (SRM) Client" />
					<attribute name="Vendor" value="Fermi National Accelerator Laboratory" />
					<attribute name="Date" value="${jar.timestamp}" />
				</section>
				<section name="Copyright">
					<attribute name="Copy" value="Copyright (c) 2002-2008 Fermi National Accelerator Laboratory" />
				</section>
				<attribute name="Main-Class" value="gov.fnal.srm.util.Version" />
				<attribute name="Specification-Version" value="2.0.${srm.minor.version}" />
				<attribute name="Specification-Vendor" value="dCache.ORG (DESY,FERMI)" />
				<attribute name="Package-Title" value="Storage Resource Manager (SRM) Client" />
				<attribute name="Package-Version" value="2.0.${srm.minor.version}" />
				<attribute name="Package-Vendor" value="Fermi National Accelerator Laboratory"	/>
			</manifest>
		</jar>

	</target>


	<target name="srmclient-bin" depends="srmclient.jar">

	<!-- directory layout :

	<SRM client home>-|
					  |-bin
					  |-lib
					  |-sbin
					  |-conf
	-->


		<mkdir dir="${binDir}/srm" />
		<mkdir dir="${binDir}/srm/lib" />
		<mkdir dir="${binDir}/srm/sbin" />
		<mkdir dir="${binDir}/srm/bin" />
		<mkdir dir="${binDir}/srm/conf" />

		<!-- jar files -->

		<copy file="${classesDir}/srm_client.jar" todir="${binDir}/srm/lib/" />
		<copy file="${classesDir}/srm.jar" todir="${binDir}/srm/lib/" />

		<copy file="${sourceDir}/bin/adler32" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/adler32"  perm="+x"/>

		<copy file="${sourceDir}/bin/command-line-client" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/command-line-client"  perm="+x"/>

		<copy file="${sourceDir}/bin/gridftpcopy" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/gridftpcopy"  perm="+x"/>

		<copy file="${sourceDir}/bin/gridftplist" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/gridftplist"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-get-request-status" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-get-request-status"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-get-request-summary" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-get-request-summary"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-get-request-tokens" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-get-request-tokens"  perm="+x"/>

		<copy file="${sourceDir}/bin/srmcp" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srmcp"  perm="+x"/>

		<copy file="${sourceDir}/bin/srmls" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srmls"  perm="+x"/>

		<copy file="${sourceDir}/bin/srmrm" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srmrm"  perm="+x"/>

		<copy file="${sourceDir}/bin/srmmkdir" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srmmkdir"  perm="+x"/>

		<copy file="${sourceDir}/bin/srmmv" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srmmv"  perm="+x"/>

		<copy file="${sourceDir}/bin/srmrmdir" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srmrmdir"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm_v1" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm_v1"  perm="+x"/>

		<copy file="${sourceDir}/bin/srmstage" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srmstage"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-advisory-delete" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-advisory-delete"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-storage-element-info" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-storage-element-info"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-get-metadata" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-get-metadata"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-bring-online" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-bring-online"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-check-permissions" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-check-permissions"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-extend-file-lifetime" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-extend-file-lifetime"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-get-permissions" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-get-permissions"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-get-space-metadata" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-get-space-metadata"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-get-space-tokens" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-get-space-tokens"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-release-space" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-release-space"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-reserve-space" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-reserve-space"  perm="+x"/>

		<copy file="${sourceDir}/bin/srm-set-permissions" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srm-set-permissions"  perm="+x"/>

		<copy file="${sourceDir}/bin/srmping" todir="${binDir}/srm/bin/" />
                <chmod file="${binDir}/srm/bin/srmping"  perm="+x"/>

		<copy file="${sourceDir}/sbin/srm" todir="${binDir}/srm/sbin/" />
                <chmod file="${binDir}/srm/sbin/srm"  perm="+x"/>

		<copy file="${sourceDir}/sbin/timeout.sh" todir="${binDir}/srm/sbin/" />
                <chmod file="${binDir}/srm/sbin/timeout.sh"  perm="+x"/>

		<copy file="${sourceDir}/sbin/url-copy.sh" todir="${binDir}/srm/sbin/" />
                <chmod file="${binDir}/srm/sbin/url-copy"  perm="+x"/>

		<copy file="${sourceDir}/conf/SRMServerV1.map" todir="${binDir}/srm/conf" />
		<copy file="${sourceDir}/conf/JHRM.map" todir="${binDir}/srm/conf" />


		<!-- external jars -->
		<!-- axis -->
		<mkdir dir="${binDir}/srm/lib/axis" />
		<property name="axisVersion" value="axis-1_3" />
		<copy todir="${binDir}/srm/lib/axis">
			<fileset dir="${libDir}/axis/${axisVersion}/lib/">
				<include name="*.jar" />
			</fileset>
		</copy>

		<!-- cog -->
		<!-- know as globus :) -->
		<mkdir dir="${binDir}/srm/lib/globus" />
		<property name="cogVersion" value="cog-srmlib" />
		<copy todir="${binDir}/srm/lib/globus">
			<fileset dir="${libDir}/cog/${cogVersion}">
				<include name="*.jar" />
			</fileset>
		</copy>



		<!-- glue -->
		<mkdir dir="${binDir}/srm/lib/glue" />
		<property name="glueVersion" value="glue-srmlib" />
		<copy todir="${binDir}/srm/lib/glue">
			<fileset dir="${libDir}/glue/${glueVersion}">
				<include name="*.jar" />
			</fileset>
		</copy>


		<!-- jdom -->
		<mkdir dir="${binDir}/srm/lib/jdom" />
		<copy file="${libDir}/jdom/jdom.jar" todir="${binDir}/srm/lib/dom" />

		<!-- bcprovider -->
		<mkdir dir="${binDir}/srm/lib/security" />
                <copy todir="${binDir}/srm/lib/security">
                        <fileset dir="${libDir}/security">
                                <include name="bcprov-jdk15-133.jar" />
                        </fileset>
                </copy>

	</target>


</project>


