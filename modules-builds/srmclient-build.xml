<?xml version="1.0"?>
<project name="srmclient" default="help">


    <property name="srmclient.build.dir" location="${buildDir}/srmclient" />
    <property name="srmclient.version" value="2.1.${release.minor.id}-${patch.id}" />
    <property name="srmclient.vendor" value="Fermi National Accelerator Laboratory" />


    <property name="srm_client.jar" value="${classesDir}/srm_client.jar" />

    <selector id="srmclient.selector">
        <and>
            <filename name="**/ArgParser.java" />
            <filename name="**/Configuration.java" />
            <filename name="**/Copier.java" />
            <filename name="**/CopyJob.java" />
            <filename name="**/SRMClient.java" />
            <filename name="**/SRMGetClientV1.java" />
            <filename name="**/SRMGetClientV2.java" />
            <filename name="**/SRMPutClientV1.java" />
            <filename name="**/SRMPutClientV2.java" />
            <filename name="**/SRMLsClientV2.java" />
            <filename name="**/ShellCommandExecuter.java" />
            <filename name="**/SRMDispatcher.java" />
            <filename name="**/KFTPArgsConverter.java" />
            <filename name="**/DccpArgsConverter.java" />
            <filename name="**/CopyJobFileReader.java" />
            <filename name="**/SRMGetFileMetaDataClientV1.java" />
            <filename name="**/SRMAdvisoryDeleteClientV1.java" />
            <filename name="**/SRMGetRequestStatusClientV1.java" />
            <filename name="**/Report.java" />
            <filename name="**/SRMRmClientV2.java" />
            <filename name="**/SRMMkDirClientV2.java" />
            <filename name="**/SRMRmdirClientV2.java" />
            <filename name="**/SRMMvClientV2.java" />
            <filename name="**/Version.java" />
            <filename name="**/SRMV1CopyJob.java" />
            <filename name="**/SRMV2CopyJob.java" />
            <filename name="**/SRMCopyClientV2.java" />
            <filename name="**/SRMCopyClientV1.java" />
            <filename name="**/SRMStageClientV1.java" />
            <filename name="**/SRMGetRequestSummaryClientV2.java" />
            <filename name="**/SRMGetRequestTokensClientV2.java" />
        </and>
    </selector>


    <path id="srmclient.classpath">
        <pathelement location="${classesDir}/srm.jar" />
        <fileset dir="${axis.untared}" includes="**/*.jar" excludes="**/log4j-*.jar"/>
        <fileset dir="${tomcat.untared}/common/lib/" includes="*.jar" excludes="servlet-api.jar"/>
        <fileset dir="${tomcat.untared}/server/lib/" includes="*.jar" />
        <fileset dir="${libDir}/cog" includes="**/*.jar" />
        <fileset dir="${libDir}/security" includes="**/*.jar" />
        <fileset dir="${glite.untarred}" includes="**/*.jar" />
        <fileset dir="${libDir}/terapaths" includes="*.jar" />
        <fileset dir="${libDir}/log4j" includes="*.jar" />
        <pathelement location="${libDir}/jdom/jdom.jar" />
        <pathelement location="${glue.untared}/GLUE-STD.jar" />
        <pathelement location="${glue.untared}/dom.jar" />
        <pathelement location="${glue.untared}/jnet.jar" />
        <pathelement location="${glue.untared}/jsse.jar" />
        <pathelement location="${glue.untared}/jcert.jar" />
        <pathelement location="${classesDir}/cells.jar" />
        <fileset dir="${libDir}/servlet-api/" includes="*.jar" />
    </path>

    <!--
        compile SRM client
    -->

    <target name="-srmclient.compile">

        <mkdir dir="${srmclient.build.dir}" />

        <javac destdir="${srmclient.build.dir}" classpathref="srmclient.classpath" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}">
            <src path="${srmclient.src}" />
            <include name="gov/fnal/srm/util/ArgParser.java" />
            <include name="gov/fnal/srm/util/Configuration.java" />
            <include name="gov/fnal/srm/util/Copier.java" />
            <include name="gov/fnal/srm/util/CopyJob.java" />
            <include name="gov/fnal/srm/util/SRMClient.java" />
            <include name="gov/fnal/srm/util/SRMGetClientV1.java" />
            <include name="gov/fnal/srm/util/SRMGetClientV2.java" />
            <include name="gov/fnal/srm/util/SRMPutClientV1.java" />
            <include name="gov/fnal/srm/util/SRMPutClientV2.java" />
            <include name="gov/fnal/srm/util/SRMLsClientV2.java" />
            <include name="gov/fnal/srm/util/ShellCommandExecuter.java" />
            <include name="gov/fnal/srm/util/SRMDispatcher.java" />
            <include name="gov/fnal/srm/util/KFTPArgsConverter.java" />
            <include name="gov/fnal/srm/util/DccpArgsConverter.java" />
            <include name="gov/fnal/srm/util/CopyJobFileReader.java" />
            <include name="gov/fnal/srm/util/SRMGetFileMetaDataClientV1.java" />
            <include name="gov/fnal/srm/util/SRMAdvisoryDeleteClientV1.java" />
            <include name="gov/fnal/srm/util/SRMGetRequestStatusClientV1.java" />
            <include name="gov/fnal/srm/util/Report.java" />
            <include name="gov/fnal/srm/util/SRMRmClientV2.java" />
            <include name="gov/fnal/srm/util/SRMMkDirClientV2.java" />
            <include name="gov/fnal/srm/util/SRMRmdirClientV2.java" />
            <include name="gov/fnal/srm/util/SRMMvClientV2.java" />
            <include name="gov/fnal/srm/util/Version.java" />
            <include name="gov/fnal/srm/util/SRMV1CopyJob.java" />
            <include name="gov/fnal/srm/util/SRMV2CopyJob.java" />
            <include name="gov/fnal/srm/util/SRMCopyClientV2.java" />
            <include name="gov/fnal/srm/util/SRMCopyClientV1.java" />
            <include name="gov/fnal/srm/util/SRMStageClientV1.java" />
            <include name="gov/fnal/srm/util/SRMGetRequestSummaryClientV2.java" />
            <include name="gov/fnal/srm/util/SRMGetRequestTokensClientV2.java" />

        </javac>

    </target>

    <!--
        buid the jar file, compile if required
    -->



    <target name="-srmclient.jar" depends="-srmclient.compile">

        <jar jarfile="${srm_client.jar}">

            <fileset dir="${srmclient.build.dir}" includes="**/*.class" />
            <manifest>
                <section name="Shared">
                    <attribute name="Title" value="Storage Resource Manager (SRM) Client" />
                    <attribute name="Vendor" value="${srmclient.vendor}" />
                    <attribute name="Version" value="${srmclient.version}" />
                    <attribute name="Date" value="${jar.timestamp}" />
                </section>
                <attribute name="Main-Class" value="gov.fnal.srm.util.Version" />
                <attribute name="Specification-Version" value="${srmclient.version}" />
                <attribute name="Specification-Vendor" value="${srmclient.vendor}" />
                <attribute name="Specification-Title" value="Storage Resource Manager (SRM)" />
            </manifest>
        </jar>

    </target>


    <!--
        'install' srm client into ${srmclient.bin.dir}
    -->

    <target name="-srmclient.bin" depends="-srmclient.jar">

        <!-- directory layout :

    <SRM client home>-|
                      |-bin
                      |-lib
                      |-sbin
                      |-conf
    -->


        <mkdir dir="${srmclient.bin.dir}" />
        <mkdir dir="${srmclient.bin.dir}/lib" />
        <mkdir dir="${srmclient.bin.dir}/sbin" />
        <mkdir dir="${srmclient.bin.dir}/bin" />
        <mkdir dir="${srmclient.bin.dir}/conf" />

        <!-- jar files -->

        <copy file="${classesDir}/srm_client.jar" todir="${srmclient.bin.dir}/lib/" />
        <copy file="${classesDir}/srm.jar" todir="${srmclient.bin.dir}/lib/" />

        <copy file="${srmclient.src}/bin/adler32" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/adler32" perm="+x" />

        <copy file="${srmclient.src}/bin/command-line-client" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/command-line-client" perm="+x" />

        <copy file="${srmclient.src}/bin/gridftpcopy" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/gridftpcopy" perm="+x" />

        <copy file="${srmclient.src}/bin/gridftplist" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/gridftplist" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-get-request-status" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-get-request-status" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-get-request-summary" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-get-request-summary" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-get-request-tokens" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-get-request-tokens" perm="+x" />

        <copy file="${srmclient.src}/bin/srmcp" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srmcp" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-abort-request" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-abort-request" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-abort-files" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-abort-files" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-release-files" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-release-files" perm="+x" />

        <copy file="${srmclient.src}/bin/srmls" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srmls" perm="+x" />

        <copy file="${srmclient.src}/bin/srmrm" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srmrm" perm="+x" />

        <copy file="${srmclient.src}/bin/srmmkdir" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srmmkdir" perm="+x" />

        <copy file="${srmclient.src}/bin/srmmv" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srmmv" perm="+x" />

        <copy file="${srmclient.src}/bin/srmrmdir" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srmrmdir" perm="+x" />

        <copy file="${srmclient.src}/bin/srm_v1" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm_v1" perm="+x" />

        <copy file="${srmclient.src}/bin/srmstage" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srmstage" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-advisory-delete" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-advisory-delete" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-storage-element-info" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-storage-element-info" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-get-metadata" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-get-metadata" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-bring-online" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-bring-online" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-check-permissions" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-check-permissions" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-extend-file-lifetime" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-extend-file-lifetime" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-get-permissions" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-get-permissions" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-get-space-metadata" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-get-space-metadata" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-get-space-tokens" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-get-space-tokens" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-release-space" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-release-space" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-reserve-space" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-reserve-space" perm="+x" />

        <copy file="${srmclient.src}/bin/srm-set-permissions" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srm-set-permissions" perm="+x" />

        <copy file="${srmclient.src}/bin/srmping" todir="${srmclient.bin.dir}/bin/" />
        <chmod file="${srmclient.bin.dir}/bin/srmping" perm="+x" />

        <copy file="${srmclient.src}/sbin/srm" todir="${srmclient.bin.dir}/sbin/" />
        <chmod file="${srmclient.bin.dir}/sbin/srm" perm="+x" />

        <copy file="${srmclient.src}/sbin/timeout.sh" todir="${srmclient.bin.dir}/sbin/" />
        <chmod file="${srmclient.bin.dir}/sbin/timeout.sh" perm="+x" />

        <copy file="${srmclient.src}/sbin/url-copy.sh" todir="${srmclient.bin.dir}/sbin/" />
        <chmod file="${srmclient.bin.dir}/sbin/url-copy" perm="+x" />

        <copy file="${srmclient.src}/conf/SRMServerV1.map" todir="${srmclient.bin.dir}/conf" />
        <copy file="${srmclient.src}/conf/JHRM.map" todir="${srmclient.bin.dir}/conf" />


        <!-- external jars -->
        <!-- axis -->
        <mkdir dir="${srmclient.bin.dir}/lib/axis" />
        <copy todir="${srmclient.bin.dir}/lib/axis">
            <fileset dir="${axis.untared}/lib/">
                <include name="*.jar" />
                <exclude name="log4j-*.jar"/>
            </fileset>
        </copy>

        <!-- log4j -->
        <mkdir dir="${srmclient.bin.dir}/lib/log4j" />
        <copy todir="${srmclient.bin.dir}/lib/log4j">
            <fileset dir="${axis.untared}/lib/">
                <include name="*.jar"/>
            </fileset>
        </copy>

        <!-- cog -->
        <!-- know as globus :) -->
        <mkdir dir="${srmclient.bin.dir}/lib/globus" />
        <property name="cogVersion" value="cog-srmlib" />
        <copy todir="${srmclient.bin.dir}/lib/globus">
            <fileset dir="${libDir}/cog/${cogVersion}">
                <include name="*.jar" />
            </fileset>
        </copy>



        <!-- glue -->
        <mkdir dir="${srmclient.bin.dir}/lib/glue" />
        <property name="glueVersion" value="glue-srmlib" />
        <copy todir="${srmclient.bin.dir}/lib/glue">
            <fileset dir="${glue.untared}">
                <include name="*.jar" />
                <exclude name="servlet.jar"/>
            </fileset>
        </copy>


        <!-- jdom -->
        <mkdir dir="${srmclient.bin.dir}/lib/jdom" />
        <copy file="${libDir}/jdom/jdom.jar" todir="${srmclient.bin.dir}/lib/dom" />

        <!-- bcprovider -->
        <mkdir dir="${srmclient.bin.dir}/lib/security" />
        <copy todir="${srmclient.bin.dir}/lib/security">
            <fileset dir="${libDir}/security">
                <include name="bcprov-jdk15-143.jar" />
            </fileset>
        </copy>

    </target>


</project>


