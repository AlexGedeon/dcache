<!-- $Id: dcache-core-build.xml,v 1.45 2008-10-05 09:22:38 behrmann Exp $ -->

<project name="Core" default="help" basedir=".">

  <!-- package name. have to be the same as in the cvs -->
  <property name="package" value="dCache" />


	<!-- import the common part -->

	<import file="${buildTop}/common/common.xml"/>

	<!--
          Properties  -  the following properties, paths, and selectors
                         define the locations and files for dCache
  -->

	<!-- Output Files
       For each of these jar files there are targets below -->

	<property name="dcache.jar" location="${classesDir}/dcache.jar" />
	<property name="dcache-replica.jar" location="${classesDir}/dcache-replica.jar" />
	<property name="dcache-srm.jar" location="${classesDir}/dcache-srm.jar" />
	<property name="xrootd-tokenauthz.jar" location="${classesDir}/xrootd-tokenauthz.jar" />
	<property name="chimera-provider.jar" location="${classesDir}/chimera-provider.jar" />
	<property name="info.jar" location="${classesDir}/info.jar" />

	<!-- this should be in 'common.xml' but that didnt work -->
	<target name="cleanall" depends="clean" description="Remove everything produced by me.">
		<delete file="${dcache.jar}" />
		<delete file="${dcache-srm.jar}" />
		<delete file="${xrootd-tokenauthz.jar}" />
		<delete file="${info.jar}" />
	</target>


	<target name="isUptodate.dcache.jar">
		  <condition property="dcache.jar.upToDate">
		    <and>
              <available file="${dcache.jar}" type="file" />
	          <uptodate targetfile="${dcache.jar}">
	          	<srcfiles dir="${sourceDir}">
	          		<include name="**/*.java" />
	          	</srcfiles>
	          </uptodate>
		    </and>
		  </condition>
	</target>

	<target name="isUptodate.dcache-srm.jar">
		  <condition property="dcache-srm.jar.upToDate">
		    <and>
              <available file="${dcache-srm.jar}" type="file" />
	          <uptodate targetfile="${dcache-srm.jar}">
	          	<srcfiles dir="${sourceDir}">
	          		<include name="**/*.java" />
	          		<include name="**/*.jdo" />
	          	</srcfiles>
	          </uptodate>
		    </and>
		  </condition>
	</target>

	<target name="isUptodate.xrootd-tokenauthz.jar">
		  <condition property="xrootd-tokenauthz.jar.upToDate">
		    <and>
              <available file="${xrootd-tokenauthz.jar}" type="file" />
	          <uptodate targetfile="${xrootd-tokenauthz.jar}">
	          	<srcfiles dir="${sourceDir}">
	          		<include name="**/*.java" />
	          	</srcfiles>
	          </uptodate>
		    </and>
		  </condition>
	</target>

	<target name="isUptodate.info.jar">
		<condition property="info.jar.upToDate">
			<and>
				<available file="${info.jar}" type="file" />
				<uptodate targetfile="${info.jar}">
					<srcfiles dir="${sourceDir}">
						<include name="**/*.java"/>
					</srcfiles>
				</uptodate>
			</and>
		</condition>
	</target>

        <target name="isDependPresent">
          <whichresource
              class="org.apache.tools.ant.taskdefs.optional.jdepend.JDependTask"
              property="depend.present"/>
        </target>

	<!-- Java sources
       These have been derived from packageSets/core.pl and packageSets/protocols.pl -->

	<property name="dcache.packagePrefix" value="diskCacheV111" />

	<!-- Classpath for dcache.jar -->

	<selector id="dcache.classpath.selector">
		<or>
			<filename name="**/cells.jar" />
			<filename name="log4j/log4j-1.2.8.jar" />
			<filename name="dbcp/c3p0-0.9.1.2.jar" />
			<filename name="berkeleyDB/je-3.2.76.jar" />
		        <filename name="Chimera/chimera-acl.jar" />
			<filename name="smc/statemap.jar" />
                        <filename name="dbcp/commons-pool.jar" />
                        <filename name="dbcp/commons-dbcp.jar" />
		</or>
	</selector>

	<selector id="chimera.classpath.selector">
		<or>
			<filename name="**/cells.jar" />
			<filename name="**/dcache.jar" />
			<filename name="Chimera/chimera-core.jar" />
			<filename name="Chimera/chimera-nfs.jar" />
            <filename name="Chimera/oncrpc.jar" />
            <filename name="Chimera/portmap.jar" />
		    <filename name="Chimera/chimera-acl.jar" />
			<filename name="log4j/log4j-1.2.8.jar" />
		</or>
	</selector>


    <selector id="replica.classpath.selector">
        <or>
            <filename name="**/cells.jar" />
            <filename name="**/dcache.jar" />
            <filename name="dbcp/commons-pool.jar" />
            <filename name="dbcp/commons-dbcp.jar" />
            <filename name="log4j/log4j-1.2.8.jar" />
        </or>
    </selector>


	<path id="dcache.classpath">
		<fileset dir="${classesDir}">
			<selector refid="dcache.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="dcache.classpath.selector" />
		</fileset>
	</path>

	<path id="chimera.classpath">
		<fileset dir="${classesDir}">
			<selector refid="chimera.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="chimera.classpath.selector" />
		</fileset>
	</path>

    <path id="replica.classpath">
        <fileset dir="${classesDir}">
           <selector refid="replica.classpath.selector" />
        </fileset>
        <fileset dir="${libDir}">
            <selector refid="replica.classpath.selector" />
        </fileset>
    </path>

 	<!-- Classpath for dcache-srm.jar - This is the same as for srm.jar in the srm CVS module -->

	<selector id="dcache-srm.classpath.selector">
		<or>
			<filename name="**/dcache.jar" />
			<filename name="**/srm.jar" />
			<filename name="jdom/jdom.jar" />
			<filename name="cog/**/*.jar" />
			<filename name="axis/**/*.jar" />
			<filename name="glue/**/GLUE-STD.jar" />
			<filename name="glue/**/dom.jar" />
			<filename name="glue/**/jnet.jar" />
			<filename name="glue/**/jsse.jar" />
			<filename name="glue/**/jcert.jar" />
			<filename name="glue/**/servlet.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/bin/*.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/common/lib/*.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/server/lib/*.jar" />
			<filename name="jpox/jdo2-api-2.0.jar" />
			<filename name="jpox/jpox-SNAPSHOT.jar" />
		</or>
	</selector>


	<path id="dcache-srm.classpath">
		<fileset dir="${classesDir}">
			<selector refid="dcache-srm.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="dcache-srm.classpath.selector" />
		</fileset>
	</path>


	<!-- Classpath for enhancement -->


	<selector id="dcache-srm-enhance.classpath.selector">
		<or>
			<filename name="**/cells.jar" />
			<filename name="jpox/bcel-5.1.jar" />
			<filename name="jpox/log4j-1.2.13.jar" />
			<filename name="jpox/jdo2-api-2.0.jar" />
			<filename name="jpox/jpox-enhancer-SNAPSHOT.jar" />
			<filename name="jpox/jpox-SNAPSHOT.jar" />
		</or>
	</selector>

	<path id="dcache-srm-enhance.classpath">
		<fileset dir="${classesDir}">
			<selector refid="dcache-srm-enhance.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="dcache-srm-enhance.classpath.selector" />
		</fileset>
	    <pathelement path="${buildDir}/dcache-srm"/>
        <pathelement path="${buildDir}/core"/>
	</path>


	<!-- Classpath for gplzma.jar - This is the same as for srm.jar in the srm CVS module -->

	<selector id="gplazma.classpath.selector">
		<or>
			<filename name="**/srm.jar" />
			<filename name="cog/**/*.jar" />
			<filename name="axis/**/*.jar" />
			<filename name="gplazma-libs/**/*.jar" />
			<filename name="security/bcprov-jdk15-133.jar" />
		</or>
	</selector>


	<path id="gplazma.classpath">
		<fileset dir="${classesDir}">
			<selector refid="gplazma.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="gplazma.classpath.selector" />
		</fileset>
	</path>

	<!-- Classpath for xrootd-tokenauthz.jar -->

	<selector id="xrootd-tokenauthz.classpath.selector">
		<or>
			<filename name="**/dcache.jar" />
			<filename name="**/cells.jar" />
			<filename name="security/bcprov-jdk15-133.jar" />
		</or>
	</selector>


	<path id="xrootd-tokenauthz.classpath">
		<fileset dir="${classesDir}">
			<selector refid="xrootd-tokenauthz.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="xrootd-tokenauthz.classpath.selector" />
		</fileset>
	</path>

	<!-- Classpath for info.jar -->

	<selector id="info.classpath.selector">
		<or>
			<filename name="**/dcache.jar" />
			<filename name="**/cells.jar" />
		</or>
	</selector>

	<path id="info.classpath">
		<fileset dir="${classesDir}">
			<selector refid="info.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="info.classpath.selector" />
		</fileset>
	</path>

	<!--       =======
             TARGETS
             =======          -->

	<!--
             Targets for dcache.jar
  -->

	<!-- Depend -->

        <target name="dcache.depend" depends="isDependPresent"
                if="depend.present">
          <depend srcdir="${sourceDir}"
                  destdir="${buildDir}/core"/>
        </target>

        <!-- The SMC invocation part. Without the ant-contrib tasks, we
             need to add each .sm file one by one below. -->
        <target name="dcache.smc"
                description="Compile state machines using SMC">
          <mkdir dir="${buildDir}/core/org/dcache/services/pinmanager1"/>
          <smc target="java"
               smfile="${sourceDir}/org/dcache/services/pinmanager1/Extender.sm"
               destdir="${buildDir}/core/org/dcache/services/pinmanager1/"
               smcjar="${smc.jar}"/>
          <smc target="java"
               smfile="${sourceDir}/org/dcache/services/pinmanager1/Unpinner.sm"
               destdir="${buildDir}/core/org/dcache/services/pinmanager1/"
               smcjar="${smc.jar}"/>
          <smc target="java"
               smfile="${sourceDir}/org/dcache/services/pinmanager1/Pinner.sm"
               destdir="${buildDir}/core/org/dcache/services/pinmanager1/"
               smcjar="${smc.jar}"/>
        </target>

	<!-- Compile -->

	<target name="dcache.compile"
                depends="prepare,dcache.smc,dcache.depend"
                unless="dcache.jar.upToDate"
                description="Compile Java code for dcache.jar">

		<mkdir dir="${buildDir}/core" />

		<javac destdir="${buildDir}/core" classpathref="dcache.classpath" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}"  encoding="${javac.encoding}">

			<src path="${sourceDir}" />
			<src path="${buildDir}/core" />

                        <classpath refid="gplazma.classpath"/>
                        <classpath refid="dcache.classpath" />

			<include name="${dcache.packagePrefix}/**" />
			<include name="${dcache.packagePrefix}/services/authorization/**" />
			<include name="org/**" />
			<exclude name="${dcache.packagePrefix}/srm/**" />
			<exclude name="${dcache.packagePrefix}/vehicles/srm/**" />
			<exclude name="${dcache.packagePrefix}/scripts/**" />
			<exclude name="${dcache.packagePrefix}/tomcat/**" />
			<exclude name="${dcache.packagePrefix}/services/GsiftpTransferManager.java" />
			<exclude name="${dcache.packagePrefix}/services/TransferManager.java" />
			<exclude name="${dcache.packagePrefix}/services/TransferManagerHandler.java" />
			<exclude name="${dcache.packagePrefix}/services/TransferManagerHandlerBackup.java" />
			<exclude name="${dcache.packagePrefix}/services/TransferManagerHandlerState.java" />
			<exclude name="org/dcache/chimera/**"/>
			<exclude name="org/dcache/xrootd/security/plugins/**" />
			<exclude name="org/dcache/xrootd/tests/**" />
			<exclude name="org/dcache/services/info/**" />
			<exclude name="${dcache.packagePrefix}/replicaManager/Semaphore.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/ReplicaManagerV2.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/ReplicaManager.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/ReplicaManagerExample.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/ReplicaDbV1.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/ReplicaDbV0.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/ReplicaDb1.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/ReplicaDb.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/DCacheCoreController.java" />
			<exclude name="${dcache.packagePrefix}/replicaManager/DCacheCoreControllerV2.java" />

		</javac>

	</target>

	<target name="dcache.jar" depends="isUptodate.dcache.jar,dcache.compile" unless="dcache.jar.upToDate" description="Create dcache.jar">

		<jar jarfile="${dcache.jar}">
			<fileset dir="${buildDir}/core" includes="**/*.class" />
			<manifest>
				<section name="Shared">
					<attribute name="Title" value="dCache Core" />
					<attribute name="Vendor" value="dCache.ORG" />
					<attribute name="Date" value="${jar.timestamp}" />
				</section>
				<section name="Copyright">
					<attribute name="Copy" value="(C) dCache.ORG  2000 - 2008" />
				</section>
				<attribute name="Main-Class" value="diskCacheV111.util.Version" />
				<attribute name="Class-Path" value="cells.jar" />
				<attribute name="Specification-Version" value="${release.name}" />
				<attribute name="Specification-Vendor" value="dCache.ORG (DESY,FERMI)" />
				<attribute name="Package-Title" value="dmg.util" />
				<attribute name="Package-Version" value="${release.name}" />
				<attribute name="Package-Vendor" value="dCache.ORG (DESY,FERMI)"	/>
			</manifest>
		</jar>

	</target>

        <target name="dcache-replica.compile" depends="dcache.jar" >

             <mkdir dir="${buildDir}/replicaManager" />

             <javac destdir="${buildDir}/replicaManager" classpathref="replica.classpath" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}"  encoding="${javac.encoding}">

                  <src path="${sourceDir}" />
                  <include name="${dcache.packagePrefix}/replicaManager/**" />
                  <exclude name="${dcache.packagePrefix}/replicaManager/ReplicaManagerExample.java" />
                  <exclude name="${dcache.packagePrefix}/replicaManager/CopyManager.java" />
                  <exclude name="${dcache.packagePrefix}/replicaManager/EasyCopyCellModule.java" />

             </javac>

        </target>

	<target name="dcache-replica.jar" depends="dcache-replica.compile" >
                <jar jarfile="${dcache-replica.jar}">
                        <fileset dir="${buildDir}/replicaManager" includes="**/*.class" />
                        <manifest>
                                <section name="Shared">
                                        <attribute name="Title" value="dCache Replica Manager" />
                                        <attribute name="Vendor" value="dCache.ORG" />
                                        <attribute name="Date" value="${jar.timestamp}" />
                                </section>
                                <section name="Copyright">
                                        <attribute name="Copy" value="(C) dCache.ORG  2000 - 2008" />
                                </section>
                                <attribute name="Class-Path" value="dcache.jar" />
                                <attribute name="Specification-Version" value="${release.name}" />
                                <attribute name="Specification-Vendor" value="dCache.ORG (DESY,FERMI)" />
                                <attribute name="Package-Title" value="dmg.util" />
                                <attribute name="Package-Version" value="${release.name}" />
                                <attribute name="Package-Vendor" value="dCache.ORG (DESY,FERMI)"        />
                        </manifest>
                </jar>

        </target>


	<!-- Chimera namespace provider  -->

	<target name="chimera-provider.compile" depends="dcache.jar">
		<mkdir dir="${buildDir}/chimera-provider" />
		<javac destdir="${buildDir}/chimera-provider"  classpathref="chimera.classpath"  source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}">
			<src path="${sourceDir}" />
			<include name="org/dcache/chimera/**" />
		</javac>
	</target>

	<target name="chimera-provider.jar" depends="chimera-provider.compile">

		<jar jarfile="${chimera-provider.jar}">
			<fileset dir="${buildDir}/chimera-provider" includes="**/*.class" />
			<manifest>
				<section name="Shared">
					<attribute name="Title" value="dCache Core" />
					<attribute name="Vendor" value="dCache.ORG" />
					<attribute name="Date" value="${jar.timestamp}" />
				</section>
				<section name="Copyright">
					<attribute name="Copy" value="(C) dCache.ORG  2000 - 2008" />
				</section>
				<attribute name="Main-Class" value="diskCacheV111.util.Version" />
				<attribute name="Class-Path" value="cells.jar" />
				<attribute name="Specification-Version" value="${release.name}" />
				<attribute name="Specification-Vendor" value="dCache.ORG (DESY,FERMI)" />
				<attribute name="Package-Title" value="dmg.util" />
				<attribute name="Package-Version" value="${release.name}" />
				<attribute name="Package-Vendor" value="dCache.ORG (DESY,FERMI)"	/>
			</manifest>
		</jar>

	</target>

	<!-- xrootd-tokenauthorization plugin -->
	<target name="xrootd-tokenauthz.compile" unless="xrootd-tokenauthz.jar.upToDate" depends="dcache.jar">

		<mkdir dir="${buildDir}/xrootd-tokenauthz" />

		<javac destdir="${buildDir}/xrootd-tokenauthz" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}">
			<src path="${sourceDir}" />

			<classpath refid="dcache.classpath"/>
			<classpath refid="xrootd-tokenauthz.classpath"/>

			<include name="org/dcache/xrootd/security/plugins/tokenauthz/**" />
		</javac>
	</target>

	<target name="xrootd-tokenauthz.jar" depends="isUptodate.xrootd-tokenauthz.jar,xrootd-tokenauthz.compile" unless="xrootd-tokenauthz.jar.upToDate" description="Create xrootd-tokenauthz.jar">

		<jar jarfile="${xrootd-tokenauthz.jar}">
			<fileset dir="${buildDir}/xrootd-tokenauthz" />

			<manifest>
				<section name="Shared">
					<attribute name="Title" value="dCache-xrootd tokenauthorization plugin" />
					<attribute name="Vendor" value="dCache.ORG" />
					<attribute name="Date" value="${jar.timestamp}" />
				</section>
				<section name="Copyright">
					<attribute name="Copy" value="(C) dCache.ORG  2000 - 2008" />
				</section>
			</manifest>
		</jar>

	</target>

	<!--
	     I N F O   S E R V I C E
	-->

	<target name="info.compile" unless="info.jar.upToDate" depends="dcache.jar">
		<mkdir dir="${buildDir}/info"/>

		<javac destdir="${buildDir}/info" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}">
			<src path="${sourceDir}" />
			<classpath refid="dcache.classpath"/>
			<classpath refid="info.classpath"/>

			<include name="org/dcache/services/info/**" />
		</javac>
	</target>


	<target name="info.jar" depends="isUptodate.info.jar,info.compile" unless="info.jar.upToDate" description="Create info.jar">
		<jar jarfile="${info.jar}">
			<fileset dir="${buildDir}/info" />

			<manifest>
				<section name="Shared">
					<attribute name="Title" value="dCache info cell" />
					<attribute name="Vendor" value="dCache.ORG" />
					<attribute name="Date" value="${jar.timestamp}" />
				</section>
				<section name="Copyright">
					<attribute name="Copy" value="(C) dCache.ORG  2000 - 2008" />
				</section>
			</manifest>
		</jar>
	</target>

	<!--
             Targets for dcache-srm.jar
  -->

	<!-- Depend -->

	<target name="dcache-srm.depend" depends="prepare,lib.tomcat.untar,lib.axis.untar,lib.glue.untar">


	</target>

	<!-- Compile -->

	<target name="dcache-srm.compile" depends="prepare,dcache-srm.depend" unless="dcache-srm.jar.upToDate" description="Compile Java code for dcache-srm.jar">

		<mkdir dir="${buildDir}/dcache-srm" />

		<javac destdir="${buildDir}/dcache-srm" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}">
			<src path="${sourceDir}" />

			<classpath refid="dcache-srm.classpath"/>
			<classpath refid="dcache.classpath"/>
			<classpath refid="gplazma.classpath"/>

			<include name="${dcache.packagePrefix}/doors/GsiFtpDoorV1.java" />
			<include name="${dcache.packagePrefix}/movers/RemoteGsiftpTransferProtocol_1.java" />
			<include name="${dcache.packagePrefix}/services/TransferManager.java" />
			<include name="${dcache.packagePrefix}/services/TransferManagerHandler.java" />
			<include name="${dcache.packagePrefix}/services/TransferManagerHandlerBackup.java" />
			<include name="${dcache.packagePrefix}/services/GsiftpTransferManager.java" />
			<include name="${dcache.packagePrefix}/doors/GssFtpDoorV1.java" />
			<include name="${dcache.packagePrefix}/doors/KerberosFtpDoorV1.java" />
			<include name="${dcache.packagePrefix}/srm/**" />
			<exclude name="${dcache.packagePrefix}/srm/v2_1/**" />
			<exclude name="${dcache.packagePrefix}/srm/security/**" />

		</javac>

	</target>


	<!-- Enhance -->


        <target name="dcache-srm.enhance" depends="dcache-srm.compile" description="Generate JDO persistency backend">
           <java classname="org.jpox.enhancer.JPOXEnhancer" classpathref="dcache-srm-enhance.classpath" fork="true" failonerror="true">
             <arg value="${sourceDir}/diskCacheV111/services/package.jdo"/>
             <sysproperty key="log4j.configuration" value="file:${sourceDir}/diskCacheV111/services/log4j.properties"/>
           </java>
        </target>


	<target name="dcache-srm.jar" depends="isUptodate.dcache-srm.jar,dcache-srm.enhance" unless="dcache-srm.jar.upToDate" description="Create dcache-srm.jar">

		<jar jarfile="${dcache-srm.jar}">
			<fileset dir="${buildDir}/dcache-srm" />
			<fileset dir="${sourceDir}" includes="**/*.jdo" />

			<manifest>
				<section name="Shared">
					<attribute name="Title" value="dCache SRM" />
					<attribute name="Vendor" value="dCache.ORG" />
					<attribute name="Date" value="${jar.timestamp}" />
				</section>
				<section name="Copyright">
					<attribute name="Copy" value="(C) dCache.ORG  2000 - 2008" />
				</section>
				<attribute name="Class-Path" value="dcache.jar" />
				<attribute name="Specification-Title" value="dCache SRM" />
				<attribute name="Specification-Version" value="${release.name}" />
				<attribute name="Specification-Vendor" value="dCache.ORG (DESY,FERMI)" />
				<attribute name="Package-Title" value="dCache SRM" />
				<attribute name="Package-Version" value="${release.name}" />
				<attribute name="Package-Vendor" value="dCache.ORG (DESY,FERMI)"	/>
			</manifest>
		</jar>

	</target>



	<!-- directory layout :

	    <dCache home>-|
					  |-classes
					  |-jobs
					  |-config-|
                               |-users-|
                                       |-acls
                                       |-meta
                                       |-relations
					  |-docs-|
					         |-images
	-->


	<target name="dcache-bin" depends="dcache.jar,dcache-replica.jar,chimera-provider.jar">

		<mkdir dir="${binDir}/classes" />
		<mkdir dir="${binDir}/jobs" />
		<mkdir dir="${binDir}/config" />
		<mkdir dir="${binDir}/config/users" />
		<mkdir dir="${binDir}/config/users/meta" />
		<mkdir dir="${binDir}/config/users/relations" />
		<mkdir dir="${binDir}/config/users/acls" />
		<mkdir dir="${binDir}/docs" />
		<mkdir dir="${binDir}/docs/images" />
		<mkdir dir="${binDir}/docs/skins" />
		<mkdir dir="${binDir}/docs/styles" />
		<mkdir dir="${binDir}/docs/scripts" />
		<mkdir dir="${binDir}/docs/scripts/sorting" />

		<!-- jar file  -->
		<copy file="${classesDir}/dcache.jar" todir="${binDir}/classes" />
		<copy file="${classesDir}/dcache-replica.jar" todir="${binDir}/classes" />

		<!-- .batch file - e.g. domains  -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/dCache.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/pnfs.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/lm.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/dir.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/door.batch" todir="${binDir}/config" />
	    <copy file="${sourceDir}/${dcache.packagePrefix}/config/authdoor.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/adminDoor.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/httpd.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/infoProvider.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/pool.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/replica.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/utility.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/statistics.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/xrootdDoor.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/chimera.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/info.batch" todir="${binDir}/config" />
		<!--<copy file="${sourceDir}/${dcache.packagePrefix}/config/aclcell.batch" todir="${binDir}/config" /> -->
		<!-- configs  -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/PoolManager.conf" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/lm.config" todir="${binDir}/config" />

		<!-- pool setup template  -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/setup.temp" todir="${binDir}/config" />


		<!-- httpd images, etc -->
		<copy todir="${binDir}/docs/images">
			<fileset dir="${sourceDir}/${dcache.packagePrefix}/docs/images" />
		</copy>
		<copy todir="${binDir}/docs/styles">
			<fileset dir="${sourceDir}/${dcache.packagePrefix}/docs/styles" />
		</copy>
		<copy todir="${binDir}/docs/scripts">
			<fileset dir="${sourceDir}/${dcache.packagePrefix}/docs/scripts" />
		</copy>
		<copy file="${sourceDir}/${dcache.packagePrefix}/docs/skins/home-skin-basic.html" todir="${binDir}/docs/skins" />
	    <copy file="${sourceDir}/${dcache.packagePrefix}/docs/statisticsHelp.html" todir="${binDir}/docs" />
		<!-- startup scripts  for official distribution -->
		<!-- common -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/generic.lib.sh" todir="${binDir}/jobs" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/wrapper2.sh" todir="${binDir}/jobs" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/initPackage.sh" todir="${binDir}/jobs" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/needFulThings.sh" todir="${binDir}/jobs" />

		<!-- HSM flush scripts -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/encp.sh" todir="${binDir}/jobs" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/hsmcp.sh" todir="${binDir}/jobs" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/hsmcpV4.sh" todir="${binDir}/jobs" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/hsmcp.rb" todir="${binDir}/jobs" />

	    <chmod dir="${binDir}/jobs"  includes="**/*" perm="ugo+rx" />

		<!-- Chimera -->
		<mkdir dir="${binDir}/classes/chimera" />
		<copy file="${libDir}/Chimera/chimera-core.jar" todir="${binDir}/classes/chimera" />
	    <copy file="${libDir}/Chimera/chimera-acl.jar" todir="${binDir}/classes/chimera" />
		<copy file="${libDir}/Chimera/chimera-config.xml" todir="${binDir}/config" />
		<copy file="${classesDir}/chimera-provider.jar" todir="${binDir}/classes/chimera" />
	    <copy file="${libDir}/Chimera/oncrpc.jar" todir="${binDir}/classes/chimera" />
	    <copy file="${libDir}/Chimera/portmap.jar" todir="${binDir}/classes/chimera" />
	    <copy file="${libDir}/Chimera/chimera-nfs.jar" todir="${binDir}/classes/chimera" />
		<copy file="${libDir}/Chimera/commons-cli-1.0.jar" todir="${binDir}/classes/chimera" />
		<copy file="${libDir}/Chimera/commons-logging.jar" todir="${binDir}/classes/chimera" />
		<copy file="${libDir}/dbcp/c3p0.properties" todir="${binDir}/config" />
		<copy file="${libDir}/dbcp/c3p0-0.9.1.2.jar" todir="${binDir}/classes/dbcp" />
	    <copy file="${libDir}/Chimera/run.xml" tofile="${binDir}/libexec/chimera/chimera-nfs-run.xml" />
	    <copy file="${libDir}/Chimera/chimera-nfs-run.sh" tofile="${binDir}/libexec/chimera/chimera-nfs-run.sh" />
		<copy file="${libDir}/Chimera/chimera-get-acl.sh" tofile="${binDir}/libexec/chimera/chimera-get-acl.sh" />
		<copy file="${libDir}/Chimera/chimera-set-acl.sh" tofile="${binDir}/libexec/chimera/chimera-set-acl.sh" />
		<copy file="${libDir}/Chimera/pnfs2chimera.sh" tofile="${binDir}/libexec/chimera/pnfs2chimera.sh" />
		<copy file="${libDir}/Chimera/pool2chimera.sh" tofile="${binDir}/libexec/chimera/pool2chimera.sh" />
		<copy file="${libDir}/Chimera/chimera-cli.sh" tofile="${binDir}/libexec/chimera/chimera-cli.sh" />
	    <chmod file="${binDir}/libexec/chimera/chimera-nfs-run.sh"  perm="ugo+rx" />
	    <chmod file="${binDir}/libexec/chimera/chimera-set-acl.sh"  perm="ugo+rx" />
	    <chmod file="${binDir}/libexec/chimera/chimera-get-acl.sh"  perm="ugo+rx" />
	    <chmod file="${binDir}/libexec/chimera/pnfs2chimera.sh"  perm="ugo+rx" />
	    <chmod file="${binDir}/libexec/chimera/pool2chimera.sh"  perm="ugo+rx" />
		<chmod file="${binDir}/libexec/chimera/chimera-cli.sh"  perm="ugo+rx" />
	    <copy todir="${binDir}/libexec/chimera/sql">
	        <fileset dir="${libDir}/Chimera/sql" />
	    </copy>

	   <!-- ACL -->
	   <!--<copy file="${buildTop}/common/acl.properties" todir="${binDir}/config" /> -->

       <!-- log4j -->
       <mkdir dir="${binDir}/classes/log4j" />
       <property name="log4jVersion" value="1.2.8" />
       <copy file="${libDir}/log4j/log4j-${log4jVersion}.jar" todir="${binDir}/classes/log4j" />

		<!-- log4j properties file -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/log4j.properties" todir="${binDir}/config" />

		<!-- BerkeleyDB -->
		<mkdir dir="${binDir}/classes/berkeleyDB/" />
		<copy file="${libDir}/berkeleyDB/je-3.2.76.jar" todir="${binDir}/classes/berkeleyDB/" />

		<!-- SMC -->
		<mkdir dir="${binDir}/classes/smc/" />
		<copy file="${libDir}/smc/statemap.jar" todir="${binDir}/classes/smc/" />

	    <!-- JDBC -->
	    <mkdir dir="${binDir}/classes/jdbc-drivers" />
	    <copy file="${libDir}/postgres-jdbc/postgresql-8.1-405.jdbc3.jar"  todir="${binDir}/classes/jdbc-drivers" />

	    <!-- DBCP for Replica Manager -->
	    <copy file="${libDir}/dbcp/commons-dbcp.jar" todir="${binDir}/classes/jdbc-drivers" />
	    <copy file="${libDir}/dbcp/commons-pool.jar" todir="${binDir}/classes/jdbc-drivers" />

	</target>


	<target name="dcache-srm-bin" depends="dcache-srm.jar">

		<mkdir dir="${binDir}/classes" />
		<mkdir dir="${binDir}/config" />

		<!-- jar file  -->
		<copy file="${classesDir}/srm.jar" todir="${binDir}/classes" />
		<copy file="${classesDir}/dcache-srm.jar" todir="${binDir}/classes" />
		<copy file="${classesDir}/cells-protocols.jar" todir="${binDir}/classes" />

		<!-- .batch file - e.g. domains  -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/srm.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/gridftpdoor.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/gsidcapdoor.batch" todir="${binDir}/config" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/gPlazma.batch" todir="${binDir}/config" />

		<!-- Web services stuff   -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/config/JHRM.map" todir="${binDir}/config" />

		<!-- LCG specific -->
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/infoDynamicSE-plugin-dcache" todir="${binDir}/jobs" />
		<copy file="${sourceDir}/${dcache.packagePrefix}/jobs/infoDynamicSE-provider-dcache" todir="${binDir}/jobs" />

		<!-- most of this stuff have nothing to do with dCache, but I can't find beter place -->

		<!-- external jars -->
		<!-- axis -->
		<mkdir dir="${binDir}/classes/axis" />
		<property name="axisVersion" value="axis-1_3" />
		<copy todir="${binDir}/classes/axis">
			<fileset dir="${libDir}/axis/${axisVersion}/lib/">
				<include name="*.jar" />
			</fileset>
		</copy>

		<!-- cog -->
		<mkdir dir="${binDir}/classes/cog" />
		<property name="cogVersion" value="cog-srmlib" />
		<copy todir="${binDir}/classes/cog">
			<fileset dir="${libDir}/cog/${cogVersion}">
				<include name="*.jar" />
			</fileset>
		</copy>


		<!-- glue -->
		<mkdir dir="${binDir}/classes/glue" />
		<property name="glueVersion" value="glue-srmlib" />
		<copy todir="${binDir}/classes/glue">
			<fileset dir="${libDir}/glue/${glueVersion}">
				<include name="*.jar" />
			</fileset>
		</copy>


		<!-- jdom -->
		<mkdir dir="${binDir}/classes/jdom" />
		<copy file="${libDir}/jdom/jdom.jar" todir="${binDir}/classes/jdom" />

		<!-- gplazma-libs -->
		<mkdir dir="${binDir}/classes/gplazma-libs" />
		<property name="gplazmaLibsVersion" value="" />
		<copy todir="${binDir}/classes/gplazma-libs">
			<fileset dir="${libDir}/gplazma-libs/${gplazmaLibsVersion}">
				<include name="*.jar" />
			</fileset>
		</copy>


		<!-- jpox -->
		<mkdir dir="${binDir}/classes/jpox" />
		<copy file="${libDir}/jpox/jdo2-api-2.0.jar" todir="${binDir}/classes/jpox" />
		<copy file="${libDir}/jpox/jpox-SNAPSHOT.jar" todir="${binDir}/classes/jpox" />

		<!-- bouncy castle -->
		<mkdir dir="${binDir}/classes/security" />
		<copy todir="${binDir}/classes/security">
			<fileset dir="${libDir}/security">
				<include name="bcprov-jdk15-133.jar" />
			</fileset>
		</copy>

	</target>
	<target name="xrootd-tokenauthz-bin" depends="xrootd-tokenauthz.jar">

		<mkdir dir="${binDir}/classes" />

		<!-- jar file  -->
		<copy file="${classesDir}/xrootd-tokenauthz.jar" todir="${binDir}/classes" />

		<!-- external jars -->
		<!-- bouncy castle -->
		<mkdir dir="${binDir}/classes/security" />
		<copy todir="${binDir}/classes/security">
			<fileset dir="${libDir}/security">
				<include name="bcprov-jdk15-133.jar" />
			</fileset>
		</copy>
	</target>

	<target name="info-bin" depends="info.jar">
		<mkdir dir="${binDir}/classes" />

		<copy file="${classesDir}/info.jar" todir="${binDir}/classes" />
	</target>

</project>

