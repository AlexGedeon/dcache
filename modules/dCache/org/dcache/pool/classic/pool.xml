<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

  
  <bean id="properties" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="location" value="domaincontext:"/>
    <property name="properties">
      <value>
        poolIoQueue=
        checkRepository=true
        waitForRepositoryReady=false
        gsiftpAllowPassivePool=true
        metaDataRepository=org.dcache.pool.repository.meta.file.FileMetaDataRepository
        metaDataRepositoryImport=
        gsiftpReadAhead=16777216
        allowCleaningPreciousFiles=false
        poolupDestination=PoolManager
        lfs=none
        pnfsmanager=PnfsManager
        flushMessageTarget=broadcast
      </value>
    </property>
  </bean>

  <bean id="pool" class="org.dcache.pool.classic.PoolV4" 
        init-method="init"
        destroy-method="cleanUp">
    <constructor-arg index="0" value="${poolname}"/>
    <constructor-arg index="1" value="
        -recover-control=yes 
        -io-queues=${poolIoQueue} 
        -allowPassivePool=${gsiftpAllowPassivePool} 
        -allowMmap=false 
        ${arguments}"/>

    <property name="baseDir"
              value="${pooldir}"/>
    <property name="version" 
              value="4"/>
    <property name="poolUpDestination" 
              value="${poolupDestination}"/>
    <property name="allowCleaningPreciousFiles" 
              value="${allowCleaningPreciousFiles}"/>
    <property name="LFSMode" 
              value="${lfs}"/>

    <property name="pnfsHandler" ref="pnfs"/>
    <property name="repository" ref="repository"/>
    <property name="checksumModule" ref="checksum"/>
    <property name="storageQueue" ref="storagequeue"/>
    <property name="storageHandler" ref="storagehandler"/>
    <property name="HSMSet" ref="hsmset"/>
    <property name="timeoutManager" ref="timeout"/>
    <property name="flushController" ref="flush"/>
    <property name="PPClient" ref="p2p"/>
  </bean>

  <!-- The PnfsHandler class takes a CellPath constructor
       argument. Notice how we can instantiate such an object
       'inline'. Spring calls this an anonymous bean, since we didn't
       give it a name and we cannot reference it from anywhere else.
  -->
  <bean id="pnfs" class="diskCacheV111.util.PnfsHandler">
    <constructor-arg>
      <bean class="dmg.cells.nucleus.CellPath">
        <constructor-arg value="${pnfsmanager}"/>
      </bean>
    </constructor-arg>
    <constructor-arg value="${poolname}"/>
  </bean>

  <bean id="legacy-repository" 
        class="org.dcache.pool.repository.v4.CacheRepositoryV4"
        destroy-method="close">
    <constructor-arg value="${pooldir}"/>
    <constructor-arg>
      <bean class="dmg.util.Args">
        <constructor-arg value="
          -metaDataRepository=${metaDataRepository}
          -metaDataRepositoryImport=${metaDataRepositoryImport}"/> 
      </bean>
    </constructor-arg>
  </bean>

  <bean id="sweeper" class="diskCacheV111.pools.SpaceSweeper2">
    <constructor-arg ref="pnfs"/>
    <constructor-arg ref="legacy-repository"/>
  </bean>

  <bean id="repository" 
        class="org.dcache.pool.repository.v5.CacheRepositoryV5"
        destroy-method="shutdown">
    <property name="pnfsHandler" ref="pnfs"/>
    <property name="sweeper" ref="sweeper"/>
    <property name="periodicChecks" value="${checkRepository}"/>
    <property name="legacyRepository" ref="legacy-repository"/>
  </bean>
  
  <bean id="repository-interpreter" class="diskCacheV111.repository.RepositoryInterpreter">
    <constructor-arg ref="legacy-repository"/>
  </bean>

  <bean id="checksum" class="org.dcache.pool.classic.ChecksumModuleV1">
    <constructor-arg ref="repository"/>
    <constructor-arg ref="pnfs"/>
  </bean>

  <bean id="storagequeue" class="org.dcache.pool.classic.StorageClassContainer">
    <constructor-arg ref="repository"/>
    <constructor-arg value="${poolname}"/>
  </bean>

  <bean id="hsmset" class="diskCacheV111.util.HsmSet"/>

  <bean id="storagehandler" class="org.dcache.pool.classic.HsmStorageHandler2">
    <constructor-arg ref="repository"/>
    <constructor-arg ref="pnfs"/>
    <constructor-arg ref="hsmset"/>
    <constructor-arg ref="checksum"/>
    <property name="flushMessageTarget" value="${flushMessageTarget}"/>
  </bean>

  <bean id="storage-interpreter" class="org.dcache.pool.classic.HsmStorageInterpreter">
    <constructor-arg ref="storagehandler"/>
    <constructor-arg ref="pnfs"/>
  </bean>

  <bean id="timeout" class="diskCacheV111.pools.JobTimeoutManager"/>

  <bean id="flush" class="org.dcache.pool.classic.HsmFlushController">
    <constructor-arg ref="storagequeue"/>
    <constructor-arg ref="storagehandler"/>
  </bean>

  <bean id="p2p" class="org.dcache.pool.classic.P2PClient">
    <constructor-arg ref="repository"/>
    <constructor-arg ref="checksum"/>
  </bean>

</beans>