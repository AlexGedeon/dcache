<?xml version="1.0"?>
<!-- ====================================================================== 
     May 8, 2006 12:13:11 PM                                                        

     srmclient    
     SRM client
                   
     tigran                                                                
     ====================================================================== -->
<project name="srmclient" default="help">
	<!-- import the common part -->

	<import file="common/common.xml" />

	
	<property name="srm_client.jar" value="${classesDir}/srm_client.jar"/>


	<target name="cleanall" depends="clean,libs.clean" description="Remove everything produced by me.">
		<delete file="${srm-client.jar}" />
	</target>


	<property name="sourceDir" location="." />
	<selector id="srmclient.selector">
		<and>
			<filename name="**/ArgParser.java" />
			<filename name="**/Configuration.java" />
			<filename name="**/Copier.java" />
			<filename name="**/CopyJob.java" />
			<filename name="**/SRMClient.java" />
			<filename name="**/SRMGetClientV1.java" />
			<filename name="**/SRMGetClientV2.java" />
			<filename name="**/SRMPutClientV1.java" />
			<filename name="**/SRMPutClientV2.java" />
			<filename name="**/SRMLsClientV2.java" />
			<filename name="**/ShellCommandExecuter.java" />
			<filename name="**/SRMDispatcher.java" />
			<filename name="**/KFTPArgsConverter.java" />
			<filename name="**/DccpArgsConverter.java" />
			<filename name="**/CopyJobFileReader.java" />
			<filename name="**/SRMGetFileMetaDataClientV1.java" />
			<filename name="**/SRMAdvisoryDeleteClientV1.java" />
			<filename name="**/SRMGetRequestStatusClientV1.java" />
			<filename name="**/Report.java" />
			<filename name="**/SRMRmClientV2.java" />
			<filename name="**/SRMMkDirClientV2.java" />
			<filename name="**/SRMRmdirClientV2.java" />
			<filename name="**/SRMMvClientV2.java" />
			<filename name="**/Version.java" />
			<filename name="**/SRMV1CopyJob.java" />
			<filename name="**/SRMV2CopyJob.java" />
			<filename name="**/SRMCopyClientV2.java" />
			<filename name="**/SRMCopyClientV1.java" />
			<filename name="**/SRMStageClientV1.java" />
		</and>
	</selector>

	<selector id="srmclient.classpath.selector">
		<or>
			<filename name="**/cells.jar" />
			<filename name="**/srm.jar" />
			<filename name="jdom/jdom.jar" />
			<filename name="cog/**/*.jar" />
			<filename name="axis/**/*.jar" />
			<filename name="glue/**/GLUE-STD.jar" />
			<filename name="glue/**/dom.jar" />
			<filename name="glue/**/jnet.jar" />
			<filename name="glue/**/jsse.jar" />
			<filename name="glue/**/jcert.jar" />
			<filename name="glue/**/servlet.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/bin/*.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/common/lib/*.jar" />
			<filename name="tomcat/apache-tomcat-5.5.20/server/lib/*.jar" />
		</or>
	</selector>

	<path id="srmclient.classpath">
		<fileset dir="${classesDir}">
			<selector refid="srmclient.classpath.selector" />
		</fileset>
		<fileset dir="${libDir}">
			<selector refid="srmclient.classpath.selector" />
		</fileset>
	</path>


	<target name="libs.cvs" description="Fetch external libs from CVS">

		<!-- One cvs checkout for each dependency -->

		<cvs command="checkout" cvsroot="${cvs.cvsroot}" cvsrsh="ssh" dest="${internalLibDir}" package="external/cog" />
		<cvs command="checkout" cvsroot="${cvs.cvsroot}" cvsrsh="ssh" dest="${internalLibDir}" package="external/tomcat" />
		<cvs command="checkout" cvsroot="${cvs.cvsroot}" cvsrsh="ssh" dest="${internalLibDir}" package="external/axis" />
		<cvs command="checkout" cvsroot="${cvs.cvsroot}" cvsrsh="ssh" dest="${internalLibDir}" package="external/glue" />
		<cvs command="checkout" cvsroot="${cvs.cvsroot}" cvsrsh="ssh" dest="${internalLibDir}" package="external/jdom" />

		<move todir="${internalLibDir}/jdom">
			<fileset dir="${internalLibDir}/external/jdom" />
		</move>
		<move todir="${internalLibDir}/glue">
			<fileset dir="${internalLibDir}/external/glue" />
		</move>
		<move todir="${internalLibDir}/axis">
			<fileset dir="${internalLibDir}/external/axis" />
		</move>
		<move todir="${internalLibDir}/tomcat">
			<fileset dir="${internalLibDir}/external/tomcat" />
		</move>
		<move todir="${internalLibDir}/cog">
			<fileset dir="${internalLibDir}/external/cog" />
		</move>

		<delete dir="${internalLibDir}/external" />

	</target>
	
	<target name="srmclient.compile" depends="srm">

		<mkdir dir="${buildDir}/srm-client" />
		
		<javac destdir="${buildDir}/srm-client" classpathref="srmclient.classpath" source="${javac.source}" target="${javac.target}" debug="${javac.debug}" verbose="${javac.verbose}">
			<src path="${sourceDir}" />
			<include name="gov/fnal/srm/util/ArgParser.java" />
			<include name="gov/fnal/srm/util/Configuration.java" />
			<include name="gov/fnal/srm/util/Copier.java" />
			<include name="gov/fnal/srm/util/CopyJob.java" />
			<include name="gov/fnal/srm/util/SRMClient.java" />
			<include name="gov/fnal/srm/util/SRMGetClientV1.java" />
			<include name="gov/fnal/srm/util/SRMGetClientV2.java" />
			<include name="gov/fnal/srm/util/SRMPutClientV1.java" />
			<include name="gov/fnal/srm/util/SRMPutClientV2.java" />
			<include name="gov/fnal/srm/util/SRMLsClientV2.java" />
			<include name="gov/fnal/srm/util/ShellCommandExecuter.java" />
			<include name="gov/fnal/srm/util/SRMDispatcher.java" />
			<include name="gov/fnal/srm/util/KFTPArgsConverter.java" />
			<include name="gov/fnal/srm/util/DccpArgsConverter.java" />
			<include name="gov/fnal/srm/util/CopyJobFileReader.java" />
			<include name="gov/fnal/srm/util/SRMGetFileMetaDataClientV1.java" />
			<include name="gov/fnal/srm/util/SRMAdvisoryDeleteClientV1.java" />
			<include name="gov/fnal/srm/util/SRMGetRequestStatusClientV1.java" />
			<include name="gov/fnal/srm/util/Report.java" />
			<include name="gov/fnal/srm/util/SRMRmClientV2.java" />
			<include name="gov/fnal/srm/util/SRMMkDirClientV2.java" />
			<include name="gov/fnal/srm/util/SRMRmdirClientV2.java" />
			<include name="gov/fnal/srm/util/SRMMvClientV2.java" />
			<include name="gov/fnal/srm/util/Version.java" />
			<include name="gov/fnal/srm/util/SRMV1CopyJob.java" />
			<include name="gov/fnal/srm/util/SRMV2CopyJob.java" />
			<include name="gov/fnal/srm/util/SRMCopyClientV2.java" />
			<include name="gov/fnal/srm/util/SRMCopyClientV1.java" />
			<include name="gov/fnal/srm/util/SRMStageClientV1.java" />

		</javac>

	</target>


	<target name="srmclient" depends="srmclient.compile">

		<jar jarfile="${srm_client.jar}">
			
			<fileset dir="${buildDir}/srm-client" includes="**/*.class" />
			<manifest>
				<section name="Shared">
					<attribute name="Title" value="dCache Core" />
					<attribute name="Vendor" value="dCache.ORG" />
					<attribute name="Date" value="${jar.timestamp}" />
				</section>
				<section name="Copyright">
					<attribute name="Copy" value="(C) dCache.ORG  2000 - 2006" />
				</section>
			</manifest>			
		</jar>				

	</target>

</project>


