<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

<!--needs to be instatiated first to allow other beans access to configuration-->
    <bean id="ConfigHolder"
        class="org.dcache.webadmin.model.configmapping.ConfigHolder">
    </bean>

    <bean id="PoolCellStub"
        class="org.dcache.webadmin.model.dataaccess.impl.ServletContextCellStub">
        <constructor-arg type="java.lang.String" value=""/>
        <property name="timeout" value="4000"/>
    </bean>

    <bean id="PoolManagerCellStub"
        class="org.dcache.webadmin.model.dataaccess.impl.ServletContextCellStub">
        <constructor-arg type="java.lang.String" value="#{ ConfigHolder.poolManagerName }"/>
        <property name="timeout" value="4000"/>
    </bean>

    <bean id="ActiveTransfersCollectorCellStub"
        class="org.dcache.webadmin.model.dataaccess.impl.ServletContextCellStub">
        <constructor-arg type="java.lang.String" value=""/>
        <property name="timeout" value="#{ ConfigHolder.collectorTimeout }"/>
    </bean>

    <bean id="CellStatusCollectorCellStub"
        class="org.dcache.webadmin.model.dataaccess.impl.ServletContextCellStub">
        <constructor-arg type="java.lang.String" value=""/>
        <property name="timeout" value="#{ ConfigHolder.collectorTimeout }"/>
    </bean>

    <bean id="PageInfoCache"
        class="org.dcache.webadmin.model.dataaccess.communication.impl.PageInfoCache">
        <constructor-arg value="#{ ConfigHolder.threadFactory }"/>
        <constructor-arg >
            <list>
                <bean id="activeTransfersCollector" class="org.dcache.webadmin.model.dataaccess.communication.collectors.ActiveTransfersCollector">
                    <property name="cellStub" ref="ActiveTransfersCollectorCellStub"/>
                    <property name="name" value="Active Transfers Collector"/>
                    <property name="update" value="#{ ConfigHolder.transfersCollectorUpdate }"/>
                    <property name="loginBrokerName" value="#{ ConfigHolder.loginBrokerName }"/>
                </bean>
                <bean id="cellStatusCollector" class="org.dcache.webadmin.model.dataaccess.communication.collectors.CellStatusCollector">
                    <property name="cellStub" ref="CellStatusCollectorCellStub"/>
                    <property name="name" value="Cellstatus Collector"/>
                    <property name="loginBrokerName" value="#{ ConfigHolder.loginBrokerName }"/>
                    <property name="pnfsManagerName" value="#{ ConfigHolder.pnfsManagerName }"/>
                    <property name="poolManagerName" value="#{ ConfigHolder.poolManagerName }"/>
                    <property name="gPlazmaName" value="#{ ConfigHolder.gplazmaName }"/>
                </bean>
                <bean id="PoolMonitorCollector" class="org.dcache.webadmin.model.dataaccess.communication.collectors.PoolMonitorCollector">
                    <property name="cellStub" ref="PoolManagerCellStub"/>
                    <property name="name" value="PoolMonitorCollector Collector"/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="CommandSenderFactory"
        class="org.dcache.webadmin.model.dataaccess.communication.impl.CellCommandSenderFactory">
        <property name="poolCellStub" ref="PoolCellStub"/>
    </bean>

    <bean id="DAOFactory" class="org.dcache.webadmin.model.dataaccess.impl.DAOFactoryImpl">
        <property name="defaultCommandSenderFactory" ref="CommandSenderFactory"/>
        <property name="pageCache" ref="PageInfoCache"/>
    </bean>

    <bean id="PoolSpaceService" class="org.dcache.webadmin.controller.impl.StandardPoolSpaceService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>
<!--now done in org.dcache.webadmin.model.dataaccess.impl.ServletContextCellStub
    change back when using gPlazma2 with a decent PW/Username plugin-->
<!--    <bean id="LoginStrategy" class="org.dcache.auth.UnionLoginStrategy">
        <description>Processes login requests</description>
        <property name="loginStrategies">
            <list>
                <bean class="org.dcache.auth.KauthFileLoginStrategy">
                    <constructor-arg>
                        <bean class="org.springframework.beans.factory.config.PropertyPathFactoryBean">
                            <property name="targetBeanName" value="InfoCellStub"/>
                            <property name="propertyPath" value="kpwdFile"/>
                        </bean>
                    </constructor-arg>
                </bean>
                <bean class="org.dcache.services.login.RemoteLoginStrategy">
                    <property name="cellStub" ref="LoginCellStub"/>
                </bean>
            </list>
        </property>
        <property name="anonymousAccess" value="NONE"/>
    </bean>

    <bean id="LogInService" class="org.dcache.webadmin.controller.impl.GuestLogInDecorator">
        <constructor-arg>
            <bean class="org.dcache.webadmin.controller.impl.LoginStrategyLogInService">
                <property name="loginStrategy" ref="LoginStrategy"/>
                <property name="adminGid">
                    <bean class="org.springframework.beans.factory.config.PropertyPathFactoryBean">
                        <property name="targetBeanName" value="InfoCellStub"/>
                        <property name="propertyPath" value="adminGid"/>
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>-->

    <bean id="PoolQueuesService" class="org.dcache.webadmin.controller.impl.StandardPoolQueuesService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>

    <bean id="PoolGroupService" class="org.dcache.webadmin.controller.impl.StandardPoolGroupService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>

    <bean id="InfoService" class="org.dcache.webadmin.controller.impl.StandardInfoService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>

    <bean id="CellsService" class="org.dcache.webadmin.controller.impl.StandardCellsService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>

    <bean id="PoolAdminService" class="org.dcache.webadmin.controller.impl.StandardPoolAdminService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>

    <bean id="CellAdminService" class="org.dcache.webadmin.controller.impl.StandardCellAdminService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>

    <bean id="LinkGroupsService" class="org.dcache.webadmin.controller.impl.StandardLinkGroupsService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>

    <bean id="ActiveTransfersService" class="org.dcache.webadmin.controller.impl.StandardActiveTransfersService">
        <constructor-arg>
            <ref bean="DAOFactory"/>
        </constructor-arg>
    </bean>

    <bean id="WebAdminInterface" class="org.dcache.webadmin.view.WebAdminInterface">
        <property name="poolSpaceService" ref="PoolSpaceService"/>
        <property name="poolQueuesService" ref="PoolQueuesService"/>
        <property name="poolGroupService" ref="PoolGroupService"/>
        <property name="infoService" ref="InfoService"/>
        <property name="cellsService" ref="CellsService"/>
        <property name="poolAdminService" ref="PoolAdminService"/>
        <property name="cellAdminService" ref="CellAdminService"/>
        <property name="linkGroupsService" ref="LinkGroupsService"/>
        <property name="activeTransfersService" ref="ActiveTransfersService"/>
        <!--<property name="logInService" ref="LogInService"/>-->
        <property name="logInService" value="#{ ConfigHolder.logInService }"/>
        <property name="httpPort" value="#{ ConfigHolder.httpPort }"/>
        <property name="httpsPort" value="#{ ConfigHolder.httpsPort }"/>
        <property name="authenticatedMode" value="#{ ConfigHolder.authenticatedMode }"/>
        <property name="dcacheName" value="#{ ConfigHolder.dcacheName }"/>
    </bean>
</beans>
