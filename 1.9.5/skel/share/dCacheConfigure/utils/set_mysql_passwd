function set_mysql_passwd () {

if [ -z ${MYSQL_PASSWORD} ]; then
    echo "mysql password not set in site-info.def"
    return 1
fi

pwds=`mysql -s -s --exec "select distinct password from \
user where user=SUBSTRING_INDEX(USER(),'@',1) \
and host=SUBSTRING_INDEX(USER(),'@',-1);" -D mysql 2> /dev/null`

if ( mysql -u root -h `hostname -f` --exec exit 2> /dev/null && [ -z "$pwds" ] ); then
    mysqladmin -h `hostname -f` password "${MYSQL_PASSWORD}"
fi

mysql -u root --pass="$MYSQL_PASSWORD" mysql --exec exit 2> /dev/null && return 0

if [ -z "$pwds" ]; then
    # passwordless account, set one
    mysqladmin password "${MYSQL_PASSWORD}" 
fi

mysql -u root --pass="$MYSQL_PASSWORD" mysql --exec exit

if [ ! $? = 0 ]; then
    echo "Can not access MySQL DB, check password."
    return 1
fi

return 0

}
