#!/bin/sh

usage() # $1 = exit status
{
    echo "Dumps pool meta data catalogue to YAML format."
    echo
    echo "Usage: $(basename $0) [OPTION]... DIR"
    echo
    echo "Valid options are:"
    echo "   -d <path to dcache installation>   default is /opt/d-cache"
    echo
    echo "DIR is the pool meta data directory."
    exit $1
}

ourHomeDir="/opt/d-cache"

# Parse options
while getopts d: opt "$@"; do
    case $opt in
        d) ourHomeDir="$OPTARG";;
    esac
done
shift `expr $OPTIND - 1`

# Directory argument must be left
if [ $# -ne 1 ]; then
    usage 1
fi

# Generate class path
if [ -r ${ourHomeDir}/classes/extern.classpath ]; then
    .  ${ourHomeDir}/classes/extern.classpath
fi

CLASSPATH=${ourHomeDir}/classes/cells.jar:${ourHomeDir}/classes/dcache.jar:${externalLibsClassPath}

# Find Java
if [ -n "$JAVA_HOME" ]; then
    JAVA="$JAVA_HOME/bin/java"
else
    JAVA="$(which java)"
fi
if [ ! -x "$JAVA" ]; then
    echo "java not found; please define JAVA_HOME"
    exit 1
fi

# Dump to yaml
"${JAVA}" -cp "${CLASSPATH}" org.dcache.pool.repository.meta.db.BerkeleyDBMetaDataRepository "$1"