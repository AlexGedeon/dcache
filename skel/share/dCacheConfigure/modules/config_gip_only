config_gip_only () {

GIP_RESPONSE=${GIP_RESPONSE:=5}
GIP_FRESHNESS=${GIP_FRESHNESS:=60}
GIP_CACHE_TTL=${GIP_CACHE_TTL:=300}
GIP_TIMEOUT=${GIP_TIMEOUT:=150}

for variable in GIP_RESPONSE GIP_FRESHNESS GIP_CACHE_TTL GIP_TIMEOUT; do
    if [ "${!variable}" -lt 0 ]; then
    	echo "ERROR: bad ${variable}: ${!variable}"
    	exit 1	
    fi		
done

INSTALL_ROOT=${INSTALL_ROOT:-/opt}

# create infosys group
if [ x`grep infosys /etc/group` == 'x' ]; then
    groupadd infosys
    gpasswd -a edginfo infosys
    gpasswd -a edguser infosys
    gpasswd -a bdiiuser infosys
    gpasswd -a rgma infosys
fi

# modify ownership and permissions for infosys group
directories="$INSTALL_ROOT/glite/var/tmp/gip \
    $INSTALL_ROOT/glite/var/cache/gip \
    $INSTALL_ROOT/glite/var/lock/gip/"

for directory in ${directories}; do
    chown -R bdiiuser.infosys ${directory}
    chmod 774 ${directory}	
    
done

# Modify the GIP configuration file
gip_conf=$INSTALL_ROOT/glite/etc/gip/glite-info-generic.conf
tmp_conf=$gip_conf.tmp

sed "
    s/^\(freshness *= *\).*/\1$GIP_FRESHNESS/
    s/^\(cache_ttl *= *\).*/\1$GIP_CACHE_TTL/
    s/^\(response *= *\).*/\1$GIP_RESPONSE/
    s/^\(timeout *= *\).*/\1$GIP_TIMEOUT/
" $gip_conf > $tmp_conf 
mv -f $tmp_conf $gip_conf 

# Create the GIP wrapper script
if [ ! -d "$INSTALL_ROOT/glite/libexec" ]; then
    mkdir -p $INSTALL_ROOT/glite/libexec
fi

cat << EOF > $INSTALL_ROOT/glite/libexec/glite-info-wrapper
#!/bin/sh

export LANG=C
$INSTALL_ROOT/glite/libexec/glite-info-generic $gip_conf

EOF

chmod a+x $INSTALL_ROOT/glite/libexec/glite-info-wrapper

return 0
}

